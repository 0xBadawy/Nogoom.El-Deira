import{r as n,j as e,c as Z,b as ee,e as R,s as L,f as $,h as V}from"./index-op0mR8ux.js";import{u as se,a as te}from"./index.esm-Dfs37iU8.js";import{G as E}from"./data-DpX12Emc.js";import{C as ae}from"./CheckboxListName-BX7DmGdM.js";import{I as re,_ as G}from"./index-ca6OEvMb.js";const le=({items:c,selected:v,text:N})=>{const[m,p]=n.useState({}),y=d=>{p(i=>{const x={...i,[d]:!i[d]};return v(c[d],x[d]),x})};n.useEffect(()=>{p({})},[c]);const k=()=>{const d=Object.keys(m).length===c.length&&Object.values(m).every(Boolean),i=c.reduce((x,U,f)=>(x[f]=!d,v(c[f],!d),x),{});p(i)},w=Object.keys(m).length===c.length&&Object.values(m).every(Boolean);return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:N}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:k,className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800  px-3",children:"تحديد الكل"})]}),c.map((d,i)=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:!!m[i],onChange:()=>y(i),className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800 px-3",children:d})]},i))]})]})},xe=()=>{const{allUsers:c,addADs:v}=Z(),[N,m]=n.useState([]),{getUserEmail:p}=ee(),[y,k]=n.useState([]);n.useState(null);const[w,d]=n.useState([]),[i,x]=n.useState([]),[U,f]=n.useState(0),[C,I]=n.useState(0),[_,g]=n.useState(!1),{register:u,handleSubmit:A,control:q,reset:B,setValue:oe,formState:{errors:l}}=se(),[O,F]=n.useState([]),[T,S]=n.useState(""),P=(t,s)=>{const r=new Date(t),o=new Date(s);return!(r>o)},M=t=>{const s={...t,governorates:y,stars:w,images:O,video:T,views:0};if(console.log(s),t.startDate&&t.endDate&&!P(t.startDate,t.endDate)){G.error("تاريخ البداية يجب ان يكون قبل تاريخ النهاية");return}v(s),F([]),S(""),B(),G.success("تم إضافة  حملة بنجاح!")},z=(t,s)=>{k(r=>{if(s){if(!r.includes(t))return[...r,t]}else return r.filter(o=>o!==t);return r})},H=(t,s)=>{d(r=>{if(s){if(!r.includes(t))return[...r,t]}else return r.filter(o=>o!==t);return r})};n.useEffect(()=>{const t=c.filter(s=>s.role==="star");x(t.map(s=>s.name)),x(t.map(s=>({name:s.name,Uid:s.Uid})))},[c]);const K=t=>{k([]),m([]),(()=>{const r=t.target.value,o=E.find(h=>h.name===r);m(o.subGovernments)})()},{fields:W,append:J,remove:Q}=te({control:q,name:"links"}),X=t=>{g(!0),f(0);const s=t.target.files;s.length&&Array.from(s).forEach(r=>{let o="noUser";const h=p();h&&(o=h);const D=R(L,`${o}/images/${r.name}`),j=$(D,r);j.on("state_changed",a=>{const b=a.bytesTransferred/a.totalBytes*100;switch(console.log(`Upload progress for ${r.name}: ${b.toFixed(2)}%`),f(b),a.state){case"paused":console.log(`Upload for ${r.name} is paused`);break;case"running":console.log(`Upload for ${r.name} is running`);break}},a=>{switch(console.error(`Upload failed for ${r.name}:`,a.message),a.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",a.serverResponse);break}g(!1)},async()=>{try{const a=await V(j.snapshot.ref);console.log(`File available at ${a}`),F(b=>[...b,a])}catch(a){console.error("Error getting download URL:",a)}g(!1)})})},Y=t=>{g(!0);const s=t.target.files[0];if(!s){console.error("No video selected");return}if(!["video/mp4","video/webm","video/ogg","video/avi","video/mkv"].includes(s.type)){alert("نوع الفيديو غير مدعوم. يرجى رفع ملف بصيغة MP4 أو WEBM أو OGG أو AVI أو MKV."),g(!1);return}let o="noUser";const h=p();h&&(o=h);const D=R(L,`${o}/videos/${s.name}`),j=$(D,s);j.on("state_changed",a=>{const b=a.bytesTransferred/a.totalBytes*100;switch(console.log(`Upload progress: ${b.toFixed(2)}%`),I(b),a.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},a=>{switch(console.error("Upload failed:",a.message),a.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",a.serverResponse);break}g(!1)},async()=>{try{const a=await V(j.snapshot.ref);console.log("Video available at",a),S(a)}catch(a){console.error("Error getting download URL:",a)}g(!1)})};return e.jsxs("div",{className:"p-2 md:p-8 dark:bg-gray-800",children:[e.jsxs("h2",{className:"text-2xl mb-4 text-gray-800  font-bold",children:["اضافة حملة جديدة"," "]}),e.jsxs("form",{onSubmit:A(M),className:"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 ",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 grid grid-cols-6 gap-3",children:[e.jsxs("div",{className:"mb-4 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"title",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",...u("title",{required:"عنوان الإعلان مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.title.message})]}),e.jsxs("div",{className:"mb-4 col-span-6 ",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"description",children:"نص الإعلان"}),e.jsx("textarea",{id:"description",...u("description",{required:"نص الإعلان مطلوب"}),className:"w-full h-52 p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.description.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"category",children:"اختر نوع الإعلان"}),e.jsxs("select",{id:"category",...u("category",{required:"اختيار النوع مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر نوعًا"}),e.jsx("option",{value:"events",children:"مناسبات"}),e.jsx("option",{value:"real_estate",children:"عقارات"}),e.jsx("option",{value:"cars",children:"سيارات"}),e.jsx("option",{value:"electronics",children:"إلكترونيات"}),e.jsx("option",{value:"services",children:"خدمات"}),e.jsx("option",{value:"home_supplies",children:"لوازم منزلية"}),e.jsx("option",{value:"personal_supplies",children:"لوازم شخصية"}),e.jsx("option",{value:"animals",children:"حيوانات"})]}),l.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.category.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx("input",{type:"date",id:"startDate",...u("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.startDate.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",id:"endDate",...u("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.endDate.message})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"images",children:[e.jsx("span",{className:"material-icons text-blue-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"صور الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"images",onChange:X,multiple:!0,className:"hidden"}),e.jsx("label",{htmlFor:"images",className:"w-full p-4 border-2 border-dashed border-blue-400 rounded-lg cursor-pointer bg-blue-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-blue-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-blue-400 text-2xl",children:"اضغط لتحميل الصور"}),e.jsx("p",{className:"mt-2 text-blue-600 dark:text-gray-300"})]})})]}),l.images&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.images.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-blue-400 to-blue-600 rounded-full transition-all",style:{width:`${U}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",U.toFixed(2),"%"]})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"video",children:[e.jsx("span",{className:"material-icons text-red-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"فيديو الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"video",onChange:Y,className:"hidden"}),e.jsx("label",{htmlFor:"video",className:"w-full p-4 border-2 border-dashed border-red-400 rounded-lg cursor-pointer bg-red-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-red-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-red-400 text-2xl",children:"اضغط لتحميل الفيديو"}),e.jsx("p",{className:"mt-2 text-red-600 dark:text-gray-300"})]})})]}),l.video&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.video.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 via-red-400 to-red-600 rounded-full transition-all",style:{width:`${C}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",C.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"md:col-span-2 col-span-6 ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"region",children:"اختر المنطقة"}),e.jsxs("select",{id:"region",...u("region",{required:"اختيار المنطقة مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",onChange:K,children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),E.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]}),l.region&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.region.message})]}),e.jsx("div",{className:"mb-4",children:e.jsx(le,{text:"اختر المحافظات",selected:z,items:N})}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{text:"اختر النجوم",selected:H,items:i})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"links",children:"روابط الإعلان"}),W.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"url",id:`link-${s}`,...u(`links.${s}.url`),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",placeholder:`رابط ${s+1}`}),e.jsx("button",{type:"button",onClick:()=>Q(s),className:"p-2 text-white bg-red-500 rounded hover:bg-red-700",children:"حذف"})]},t.id)),e.jsx("button",{type:"button",onClick:()=>J({url:""}),className:"p-2 mt-2 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة رابط جديد"})]})]})]}),_?e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!0,children:"جاري الإضافة..."}):e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة الإعلان"})]}),e.jsx(re,{position:"top-center",reverseOrder:!1})]})};export{xe as default};
