import{b as q,r as x,j as e,t as j,c as L}from"./index-BOx4tXWN.js";import{u as C}from"./index.esm-XTVrE9B6.js";import"./index-C4TlvX-B.js";import{I as F,_ as D}from"./index-CUfwLo9Z.js";import{D as O,a as $,b as M,c as A,d as B}from"./dialog-CceaKI71.js";import{B as E}from"./button-1Uql1rLY.js";import"./index-Chjiymov.js";import"./index-DZD1t6GX.js";import"./index-CTw5nY3z.js";import"./index-BDMBjcSx.js";const H=()=>{const{register:r,handleSubmit:g,watch:c,reset:v,formState:{errors:a}}=C(),{signUp:t}=q(),[n,N]=x.useState(null),[S,y]=x.useState(!1);c("password");const h=d=>d.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":d.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.",w=async d=>{if(!/^\d{10,11}$/.test(d.phone)){j.error("يجب أن يكون رقم الهاتف مكوناً من 10 أو 11 رقماً ويتكون من أرقام فقط");return}if(!/^[a-zA-Z0-9]{3,15}$/.test(d.username)){j.error("يجب أن يكون اسم المستخدم مكوناً من 3 إلى 15 حرفاً ويمكن أن يحتوي على حروف وأرقام فقط");return}if(confirm("هل انت متأكد من إضافة هذا المستخدم؟")==!0)try{await U(d)}catch{j.error("حدث خطأ أثناء إضافة المستخدم.")}else j.error("تم إلغاء العملية")},U=async d=>{N(null),y(!0);try{const{email:o,password:p,role:m,...f}=d,i=await t(o,p,f,m);if(!i.success){N(h(i.error)),j.error("حدث خطأ أثناء إضافة المستخدم.");return}j.success("تم إضافة الموظف بنجاح!"),v()}catch(o){const p=o!=null&&o.code?h(o.code):"حدث خطأ غير متوقع!";N(p),console.error("Error during submission:",o.message||o)}finally{y(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:"إضافة موظف"}),e.jsxs("form",{onSubmit:g(w),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...r("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...r("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),a.email&&e.jsx("p",{className:"text-red-500 text-sm",children:a.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...r("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),a.username&&e.jsx("p",{className:"text-red-500 text-sm",children:a.username.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-1",children:[" ","رقم الهاتف"]}),e.jsx("input",{type:"text",...r("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),a.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:a.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsx("input",{type:"password",...r("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),a.password&&e.jsx("p",{className:"text-red-500 text-sm",children:a.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...r("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsxs("option",{value:"admin",children:[e.jsx("span",{children:"مدير"})," (كل الصلاحيات)"]}),e.jsxs("option",{value:"editor",children:[e.jsx("span",{children:"محرر"}),"(كل الصلاحيات عدا المديرين والمحفظة)"]}),e.jsxs("option",{value:"viewer",children:[" ",e.jsx("span",{children:"مشاهد"})," (الدخول والمتابعة فقط)"]})]}),a.role&&e.jsx("p",{className:"text-red-500 text-sm",children:a.role.message})]}),e.jsx("div",{className:"flex flex-row",children:e.jsx("button",{type:"submit",disabled:S,className:"w-fit px-20 mx-auto bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-200",children:S?"جارٍ الحفظ...":"حفظ البيانات"})}),n&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:n})]})]})},I=({userData:r,onUserUpdated:g})=>{const{register:c,handleSubmit:v,setValue:a,reset:t,formState:{errors:n}}=C(),{signUp:N,updateUser:S}=q(),[y,h]=x.useState(null),[w,U]=x.useState(!1),d=m=>m.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":m.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.";x.useEffect(()=>{r?Object.keys(r).forEach(m=>{a(m,r[m])}):t()},[r,a,t]);const o=async m=>{const f=!!r;if(confirm(f?"هل أنت متأكد من تحديث بيانات المستخدم؟":"هل انت متأكد من إضافة هذا المستخدم؟"))try{await p(m,f),alert("تمت العملية بنجاح!")}catch(l){console.error("حدث خطأ أثناء العملية:",l),alert("حدث خطأ أثناء العملية.")}else D.error("تم إلغاء العملية")},p=async(m,f)=>{h(null),U(!0);try{const{email:i,password:s,role:l,...b}=m;if(f){const u=await S(r.Uid,{email:i,role:l,...b});if(!u.success){h(d(u.error));return}D.success("تم تحديث بيانات الموظف بنجاح!"),g&&g(u.data)}else{const u=await N(i,s,b,l);if(!u.success){h(d(u.error));return}D.success("تم إضافة الموظف بنجاح!"),t()}}catch(i){const s=i!=null&&i.code?d(i.code):"حدث خطأ غير متوقع!";h(s),console.error("Error during submission:",i.message||i)}finally{U(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:r?"تحديث بيانات الموظف":"إضافة موظف"}),e.jsxs("form",{onSubmit:v(o),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...c("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),n.name&&e.jsx("p",{className:"text-red-500 text-sm",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...c("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),n.email&&e.jsx("p",{className:"text-red-500 text-sm",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...c("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),n.username&&e.jsx("p",{className:"text-red-500 text-sm",children:n.username.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"text",...c("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),n.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:n.phone.message})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsx("input",{type:"password",...c("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),n.password&&e.jsx("p",{className:"text-red-500 text-sm",children:n.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...c("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsx("option",{value:"admin",children:"مدير"}),e.jsx("option",{value:"editor",children:"محرر"}),e.jsx("option",{value:"viewer",children:"مشاهد"})]}),n.role&&e.jsx("p",{className:"text-red-500 text-sm",children:n.role.message})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:w?"جارٍ الحفظ...":r?"تحديث البيانات":"حفظ البيانات"}),y&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:y})]}),e.jsx(F,{position:"top-center",reverseOrder:!1})]})},V=({children:r})=>e.jsx("span",{style:{position:"absolute",width:"1px",height:"1px",background:"white",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0},children:r}),_=({title:r="تأكيد العملية",message:g="هل أنت متأكد من الاستمرار؟",isOpen:c,onClose:v,onConfirm:a,onCancel:t})=>e.jsx("div",{className:"bg-white",children:e.jsx(O,{open:c,onOpenChange:v,children:e.jsxs($,{className:"bg-white",children:[e.jsxs(M,{children:[e.jsx(V,{children:e.jsx(A,{children:r})}),e.jsx("p",{children:g})]}),e.jsxs(B,{children:[e.jsx(E,{variant:"ghost",onClick:t,children:"إلغاء"}),e.jsx(E,{className:"text-white",onClick:a,children:"نعم"})]})]})})}),X=()=>{const[r,g]=x.useState([]),{allUsers:c,updateUser:v,deleteUserFromDB:a}=L(),[t,n]=x.useState(null),[N,S]=x.useState({}),[y,h]=x.useState(!1);x.useEffect(()=>{g(c),w()},[c]);const w=()=>{g(s=>s.sort((l,b)=>b.lastSeen-l.lastSeen))},U=()=>{h(!1),n(null)},d=()=>{const s=r.find(l=>l.Uid===t);S(s),h(!0)},[o,p]=x.useState(!1),m=s=>{p(!0)},f=()=>{a(t),n(null),w(),j.success("تم حذف الموظف بنجاح",{description:new Date().toLocaleString()}),p(!1)},i=()=>{p(!1),j.error("تم إلغاء العملية",{description:new Date().toLocaleString()})};return e.jsxs("div",{className:"grow md:p-8 p-3 dark:bg-gray-800",children:[e.jsx("h2",{className:"text-2xl w-full mb-4 text-",children:"صفحة ادارة الموظفين "}),e.jsxs("div",{children:[e.jsx(H,{}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"قائمة المستخدمين "}),e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-4 text-right",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right hidden md:table-cell",children:"البريد الإلكتروني"}),e.jsxs("th",{className:"py-2 px-4 text-right  md:table-cell",children:["اخر ظهور"," "]}),e.jsx("th",{className:"py-2 px-4 text-right ",children:"الوظيفية"})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((s,l)=>{var b;return s.role!="star"&&!s.isDeleted&&e.jsxs("tr",{onClick:()=>n(s.Uid),className:`border-b ${s.Uid===t?"bg-gray-200":""}`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 hidden md:table-cell",children:s.email}),e.jsx("td",{className:"py-2 px-4  md:table-cell",children:e.jsx("p",{children:(b=s==null?void 0:s.lastSeen)==null?void 0:b.toDate().toLocaleString()})}),e.jsx("td",{className:"py-2 px-4 ",children:s.role==="admin"?"مدير":s.role==="editor"?"محرر":"مشاهد"})]},l)})})]})]}),t&&e.jsx("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات المستخدم"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الاسم"}),e.jsx("span",{children:r.find(s=>s.Uid===t).name})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"البريد الإلكتروني"}),e.jsx("span",{children:r.find(s=>s.Uid===t).email})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"اسم المستخدم "}),e.jsx("span",{children:r.find(s=>s.Uid===t).username})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الوظيفة"}),e.jsx("span",{children:r.find(s=>s.Uid===t).role=="editor"?"محرر":r.find(s=>s.Uid===t).role=="admin"?"مدير":"مشاهد"})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"رقم الهاتف"}),e.jsx("span",{children:r.find(s=>s.Uid===t).phone})]})]}),e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ أخر ظهور"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.lastSeen;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ انشاء الحساب"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.createdAt;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded-lg",onClick:()=>m(),children:"حذف المستخدم"}),e.jsx(_,{title:"تأكيد الحذف",message:"هل متأكد من حذف هذا المستخدم؟",isOpen:o,onClose:()=>p(!1),onConfirm:f,onCancel:i}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg",onClick:d,children:"تعديل المستخدم"})]})]})})]}),e.jsxs("div",{className:`${y?"":"hidden"}`,children:[e.jsx(I,{userData:N,onUserUpdated:U}),";"]})]})};export{X as default};
