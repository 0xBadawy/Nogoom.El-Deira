import{r,c as w,j as s,t as o}from"./index-_Ilj38vT.js";import{C as G}from"./CheckboxListName-BMyPFnl5.js";import{u as U}from"./index.esm-DuzlAj83.js";import{G as f}from"./data-BEbSXYvH.js";const R=()=>{var x;const[c,h]=r.useState([]),[d,m]=r.useState([]),{allUsers:n,SendNotification:b}=w(),[l,p]=r.useState("all"),[i,u]=r.useState("all");r.useEffect(()=>{const e=n.filter(t=>t.role==="star");m(e.map(t=>({name:t.name,Uid:t.Uid})))},[n]);const g=(e,t)=>{h(a=>{if(t){if(!a.includes(e))return[...a,e]}else return a.filter(y=>y!==e);return a})},j=e=>{const t={...e,stars:c,readed:!1,time:new Date};if(e.message==""){o.error("لا يمكن ارسال رسالة فارغة");return}if(c.length==0){o.error("يجب اختيار نجم على الاقل");return}b(t),v(),o.success("تم ارسال اشعار بنجاح!")},{register:N,handleSubmit:S,reset:v,formState:{errors:C}}=U();return r.useEffect(()=>{let e=n.filter(t=>t.role==="star");i!=="all"&&(e=e.filter(t=>{var a;return(a=t.area)==null?void 0:a.includes(i)})),l!=="all"&&(e=e.filter(t=>t.govern===l)),m(e.map(t=>({name:t.name,Uid:t.Uid})))},[n,l,i]),s.jsx("div",{className:" flex items-center justify-center md:p-4 p-2",children:s.jsxs("div",{className:" w-full bg-white rounded-lg shadow-lg md:p-8 p-2",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"إرسال إشعار"}),s.jsxs("div",{className:"flex gap-4 mb-4",children:[s.jsxs("select",{value:l,onChange:e=>{p(e.target.value),u("all")},className:"border rounded px-2 py-1",children:[s.jsx("option",{value:"all",children:"كل المناطق"}),f.map(e=>s.jsx("option",{value:e.name,children:e.name},e.name))]}),s.jsxs("select",{value:i,onChange:e=>u(e.target.value),className:"border rounded px-2 py-1",disabled:l==="all",children:[s.jsx("option",{value:"all",children:"كل المحافظات"}),l!=="all"&&((x=f.find(e=>e.name===l))==null?void 0:x.subGovernments.map(e=>s.jsx("option",{value:e,children:e},e)))]})]}),s.jsxs("form",{onSubmit:S(j),className:"space-y-6",children:[s.jsxs("div",{className:"",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الرسالة"}),s.jsx("textarea",{...N("message"),className:"w-full h-32 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring focus:ring-blue-200",placeholder:"اكتب الرسالة هنا..."})]}),d.length>0?s.jsx("div",{children:s.jsx(G,{text:"اختر النجوم",selected:g,items:d})}):s.jsxs("div",{children:[s.jsx("h6",{className:"mt-10  font-semibold text-black",children:"اختيار النجوم"}),s.jsx("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:s.jsx("p",{className:"text-sm text-gray-600",children:" لا يوجد نجوم متاحين فى المنطفة او المحافظات المحددة "})})]}),s.jsx("button",{type:"submit",className:"w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition",children:"ارسال اشعار"})]})]})})};export{R as default};
