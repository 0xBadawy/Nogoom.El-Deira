import{r as n,j as e,c as ae,b as re,e as V,s as P,f as B,h as A}from"./index-h8CZiEUX.js";import{u as le,a as oe}from"./index.esm-CL1KPcNo.js";import{G as _}from"./data-BQug-B3m.js";import{C as ne}from"./CheckboxListName-BHyWMuJa.js";import{I as de,_ as D}from"./index-DE85BmDv.js";const ce=({items:g,selected:y,text:j})=>{const[h,k]=n.useState({}),F=c=>{k(m=>{const u={...m,[c]:!m[c]};return y(g[c],u[c]),u})};n.useEffect(()=>{k({})},[g]);const v=()=>{const c=Object.keys(h).length===g.length&&Object.values(h).every(Boolean),m=g.reduce((u,C,N)=>(u[N]=!c,y(g[N],!c),u),{});k(m)},p=Object.keys(h).length===g.length&&Object.values(h).every(Boolean);return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:j}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:v,className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800  px-3",children:"تحديد الكل"})]}),g.map((c,m)=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:!!h[m],onChange:()=>F(m),className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800 px-3",children:c})]},m))]})]})},be=()=>{const{allUsers:g,addADs:y}=ae(),[j,h]=n.useState([]),[k,F]=n.useState(),{getUserEmail:v}=re(),[p,c]=n.useState([]);n.useState(null);const[m,u]=n.useState([]),[C,N]=n.useState([]),[S,R]=n.useState(0),[L,q]=n.useState(0),[O,b]=n.useState(!1),{register:f,handleSubmit:T,control:W,reset:z,setValue:ie,formState:{errors:l}}=le(),[H,$]=n.useState(""),J=(t,s)=>{const a=new Date(t),d=new Date(s);return!(a>d)},[E,I]=n.useState([]),M=t=>{const s={...t,governorates:p,stars:m,images:E.length>0?E:["https://firebasestorage.googleapis.com/v0/b/nogoomel-deira.firebasestorage.app/o/Website%20Images%2FScreenshot_5.png?alt=media&token=e314b8df-858e-4092-b3fe-920473f514e9"],video:H,views:0};if(console.log(s),t.startDate&&t.endDate&&!J(t.startDate,t.endDate)){D.error("تاريخ البداية يجب ان يكون قبل تاريخ النهاية");return}if(p.length===0){D.error("يجب اختيار المحافظة");return}if(m.length===0){D.error("يجب اختيار النجوم");return}y(s),I([]),$(""),z(),D.success("تم إضافة  حملة بنجاح!")},K=(t,s)=>{c(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(d=>d!==t);return a})},Q=(t,s)=>{u(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(d=>d!==t);return a})};n.useEffect(()=>{u([]);const t=g.filter(s=>s.role==="star"&&s.area.some(a=>p.includes(a)));N(t.map(s=>s.name)),N(t.map(s=>({name:s.name,Uid:s.Uid})))},[g,k,p]);const X=t=>{c([]),h([]),F(t.target.value),(()=>{const a=t.target.value,d=_.find(o=>o.name===a);h(d.subGovernments)})()},{fields:Y,append:Z,remove:ee}=oe({control:W,name:"links"}),se=t=>{const s=event.target.files;console.log("Files:",s);const a=["image/jpeg","image/png","image/gif","image/bmp","image/webp"];for(let o=0;o<s.length;o++){const x=s[o];if(console.log("File type:",x.type),a.includes(x.type))console.log("Valid file type:",x.type);else{console.log("Invalid file type detected:",x.type),alert("نوع الصورة غير مدعوم. يرجى رفع ملف بصيغة JPEG أو PNG أو GIF أو BMP أو WEBP."),b(!1);return}}b(!0),R(0);const d=t.target.files;d.length&&Array.from(d).forEach(o=>{let x="noUser";const r=v();r&&(x=r);const w=V(P,`${x}/images/${o.name}`),G=B(w,o);G.on("state_changed",i=>{const U=i.bytesTransferred/i.totalBytes*100;switch(console.log(`Upload progress for ${o.name}: ${U.toFixed(2)}%`),R(U),i.state){case"paused":console.log(`Upload for ${o.name} is paused`);break;case"running":console.log(`Upload for ${o.name} is running`);break}},i=>{switch(console.error(`Upload failed for ${o.name}:`,i.message),i.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",i.serverResponse);break}b(!1)},async()=>{try{const i=await A(G.snapshot.ref);console.log(`File available at ${i}`),I(U=>[...U,i])}catch(i){console.error("Error getting download URL:",i)}b(!1)})})},te=t=>{b(!0);const s=t.target.files[0];if(!s){console.error("No video selected");return}if(!s.type.startsWith("video/")){alert("نوع الملف غير مدعوم. يرجى رفع ملف بصيغة فيديو."),b(!1);return}let a="noUser";const d=v();d&&(a=d);const o=V(P,`${a}/videos/${s.name}`),x=B(o,s);x.on("state_changed",r=>{const w=r.bytesTransferred/r.totalBytes*100;switch(console.log(`Upload progress: ${w.toFixed(2)}%`),q(w),r.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},r=>{switch(console.error("Upload failed:",r.message),r.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",r.serverResponse);break}b(!1)},async()=>{try{const r=await A(x.snapshot.ref);console.log("Video available at",r),$(r)}catch(r){console.error("Error getting download URL:",r)}b(!1)})};return e.jsxs("div",{className:"p-2 md:p-8 dark:bg-gray-800",children:[e.jsxs("h2",{className:"text-2xl mb-4 text-gray-800  font-bold",children:["اضافة حملة جديدة"," "]}),e.jsxs("form",{onSubmit:T(M),className:"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 ",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 grid grid-cols-6 gap-3",children:[e.jsxs("div",{className:"mb-4 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"title",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",...f("title",{required:"عنوان الإعلان مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.title.message})]}),e.jsxs("div",{className:"mb-4 col-span-6 ",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"description",children:"نص الإعلان"}),e.jsx("textarea",{id:"description",...f("description",{required:"نص الإعلان مطلوب"}),className:"w-full h-52 p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.description.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-3 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx("input",{type:"date",id:"startDate",...f("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.startDate.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-3 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",id:"endDate",...f("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.endDate.message})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"images",children:[e.jsx("span",{className:"material-icons text-blue-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"صور الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"images",onChange:se,multiple:!0,className:"hidden"}),e.jsx("label",{htmlFor:"images",className:"w-full p-4 border-2 border-dashed border-blue-400 rounded-lg cursor-pointer bg-blue-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-blue-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-blue-400 text-2xl",children:"اضغط لتحميل الصور"}),e.jsx("p",{className:"mt-2 text-blue-600 dark:text-gray-300"})]})})]}),l.images&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.images.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-blue-400 to-blue-600 rounded-full transition-all",style:{width:`${S}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",S.toFixed(2),"%"]})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"video",children:[e.jsx("span",{className:"material-icons text-red-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"فيديو الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"video",onChange:te,className:"hidden"}),e.jsx("label",{htmlFor:"video",className:"w-full p-4 border-2 border-dashed border-red-400 rounded-lg cursor-pointer bg-red-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-red-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-red-400 text-2xl",children:"اضغط لتحميل الفيديو"}),e.jsx("p",{className:"mt-2 text-red-600 dark:text-gray-300"})]})})]}),l.video&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.video.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 via-red-400 to-red-600 rounded-full transition-all",style:{width:`${L}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",L.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"md:col-span-2 col-span-6 ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"region",children:"اختر المنطقة"}),e.jsxs("select",{id:"region",...f("region",{required:"اختيار المنطقة مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",onChange:X,children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),_.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]}),l.region&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.region.message})]}),j.length>0?e.jsx("div",{className:"mb-4",children:e.jsx(ce,{text:"اختر المحافظات",selected:K,items:j})}):e.jsxs("div",{children:[e.jsx("h6",{className:"mt-10  font-semibold text-black",children:"اختيار المحافظات"}),e.jsx("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"يجب تحديد المنطقة أولًا"})})]}),C.length>0?e.jsx("div",{className:"mb-4",children:e.jsx(ne,{text:"اختر النجوم",selected:Q,items:C})}):e.jsxs("div",{children:[e.jsx("h6",{className:"mt-10 font-semibold text-black",children:"اختيار النجوم"}),e.jsx("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:j.length<=0?"يجب اختيار المنطقة والمحافظات اولا":"لا يوجد نجوم متاحين فى المحافظات المحددة"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"links",children:"روابط الإعلان"}),Y.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"url",id:`link-${s}`,...f(`links.${s}.url`),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",placeholder:`رابط ${s+1}`}),e.jsx("button",{type:"button",onClick:()=>ee(s),className:"p-2 text-white bg-red-500 rounded hover:bg-red-700",children:"حذف"})]},t.id)),e.jsx("button",{type:"button",onClick:()=>Z({url:""}),className:"p-2 mt-2 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة رابط جديد"})]})]})]}),O?e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!0,children:"جاري الإضافة..."}):e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة الإعلان"})]}),e.jsx(de,{position:"top-center",reverseOrder:!1})]})};export{be as default};
