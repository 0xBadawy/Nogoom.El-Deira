import{r as c,j as e,c as Z,b as ee,e as R,s as L,f as $,h as F}from"./index-D1kJxIkH.js";import{u as se,a as te}from"./index.esm-CylbFJ5w.js";import{G as E}from"./data-DEqlFrNp.js";import{C as ae}from"./CheckboxListName-CK42f5Z1.js";import{I as re,_ as V}from"./index-DUTVWf5v.js";const le=({items:i,selected:j,text:N})=>{const[g,x]=c.useState({}),w=d=>{x(m=>{const u={...m,[d]:!m[d]};return j(i[d],u[d]),u})};c.useEffect(()=>{x({})},[i]);const k=()=>{const d=Object.keys(g).length===i.length&&Object.values(g).every(Boolean),m=i.reduce((u,D,f)=>(u[f]=!d,j(i[f],!d),u),{});x(m)},U=Object.keys(g).length===i.length&&Object.values(g).every(Boolean);return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:N}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:U,onChange:k,className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800  px-3",children:"تحديد الكل"})]}),i.map((d,m)=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:!!g[m],onChange:()=>w(m),className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800 px-3",children:d})]},m))]})]})},ge=()=>{const{allUsers:i,addADs:j}=Z(),[N,g]=c.useState([]),{getUserEmail:x}=ee(),[w,k]=c.useState([]);c.useState(null);const[U,d]=c.useState([]),[m,u]=c.useState([]),[D,f]=c.useState(0),[G,I]=c.useState(0),[_,b]=c.useState(!1),{register:h,handleSubmit:q,control:A,reset:B,setValue:oe,formState:{errors:r}}=se(),[O,C]=c.useState([]),[P,S]=c.useState(""),T=(t,s)=>{const a=new Date(t),n=new Date(s);return!(a>n)},z=t=>{const s={...t,governorates:w,stars:U,images:O,video:P,views:0};if(console.log(s),t.startDate&&t.endDate&&!T(t.startDate,t.endDate)){V.error("تاريخ البداية يجب ان يكون قبل تاريخ النهاية");return}j(s),C([]),S(""),B(),V.success("تم إضافة  حملة بنجاح!")},H=(t,s)=>{k(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})},J=(t,s)=>{d(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})};c.useEffect(()=>{const t=i.filter(s=>s.role==="star");u(t.map(s=>s.name)),u(t.map(s=>({name:s.name,Uid:s.Uid})))},[i]);const K=t=>{k([]),g([]),(()=>{const a=t.target.value,n=E.find(p=>p.name===a);g(n.subGovernments)})()},{fields:M,append:Q,remove:W}=te({control:A,name:"links"}),X=t=>{b(!0),f(0);const s=t.target.files;s.length&&Array.from(s).forEach(a=>{let n="noUser";const p=x();p&&(n=p);const v=R(L,`${n}/images/${a.name}`),l=$(v,a);l.on("state_changed",o=>{const y=o.bytesTransferred/o.totalBytes*100;switch(console.log(`Upload progress for ${a.name}: ${y.toFixed(2)}%`),f(y),o.state){case"paused":console.log(`Upload for ${a.name} is paused`);break;case"running":console.log(`Upload for ${a.name} is running`);break}},o=>{switch(console.error(`Upload failed for ${a.name}:`,o.message),o.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",o.serverResponse);break}b(!1)},async()=>{try{const o=await F(l.snapshot.ref);console.log(`File available at ${o}`),C(y=>[...y,o])}catch(o){console.error("Error getting download URL:",o)}b(!1)})})},Y=t=>{b(!0);const s=t.target.files[0];if(!s){console.error("No video selected");return}let a="noUser";const n=x();n&&(a=n);const p=R(L,`${a}/videos/${s.name}`),v=$(p,s);v.on("state_changed",l=>{const o=l.bytesTransferred/l.totalBytes*100;switch(console.log(`Upload progress: ${o.toFixed(2)}%`),I(o),l.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},l=>{switch(console.error("Upload failed:",l.message),l.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",l.serverResponse);break}b(!1)},async()=>{try{const l=await F(v.snapshot.ref);console.log("Video available at",l),S(l)}catch(l){console.error("Error getting download URL:",l)}b(!1)})};return e.jsxs("div",{className:"p-2 md:p-8 dark:bg-gray-800",children:[e.jsxs("h2",{className:"text-2xl mb-4 text-gray-800  font-bold",children:["اضافة حملة جديدة"," "]}),e.jsxs("form",{onSubmit:q(z),className:"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 ",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 grid grid-cols-6 gap-3",children:[e.jsxs("div",{className:"mb-4 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"title",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",...h("title",{required:"عنوان الإعلان مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.title.message})]}),e.jsxs("div",{className:"mb-4 col-span-6 ",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"description",children:"نص الإعلان"}),e.jsx("textarea",{id:"description",...h("description",{required:"نص الإعلان مطلوب"}),className:"w-full h-52 p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.description.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"category",children:"اختر نوع الإعلان"}),e.jsxs("select",{id:"category",...h("category",{required:"اختيار النوع مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر نوعًا"}),e.jsx("option",{value:"events",children:"مناسبات"}),e.jsx("option",{value:"real_estate",children:"عقارات"}),e.jsx("option",{value:"cars",children:"سيارات"}),e.jsx("option",{value:"electronics",children:"إلكترونيات"}),e.jsx("option",{value:"services",children:"خدمات"}),e.jsx("option",{value:"home_supplies",children:"لوازم منزلية"}),e.jsx("option",{value:"personal_supplies",children:"لوازم شخصية"}),e.jsx("option",{value:"animals",children:"حيوانات"})]}),r.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.category.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx("input",{type:"date",id:"startDate",...h("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.startDate.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",id:"endDate",...h("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.endDate.message})]}),e.jsxs("div",{className:"mb-6 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-medium text-gray-800 dark:text-white mb-3 flex items-center gap-2",htmlFor:"images",children:[e.jsx("span",{className:"material-icons",children:" "})," صور الإعلان"]}),e.jsx("input",{type:"file",id:"images",onChange:X,multiple:!0,className:"w-full p-3 border-2 border-gray-300 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"}),r.images&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:r.images.message}),e.jsx("div",{className:"relative w-full mt-2 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${D}%`}})})]}),e.jsxs("div",{className:"mb-6 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-medium text-gray-800 dark:text-white mb-3 flex items-center gap-2",htmlFor:"video",children:[e.jsx("span",{className:"material-icons"})," فيديو الإعلان"]}),e.jsx("input",{type:"file",id:"video",onChange:Y,className:"w-full p-3 border-2 border-gray-300 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-blue-500 focus:outline-none"}),r.video&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:r.video.message}),e.jsx("div",{className:"relative w-full mt-2 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${G}%`}})})]})]}),e.jsxs("div",{className:"md:col-span-2 col-span-6 ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"region",children:"اختر المنطقة"}),e.jsxs("select",{id:"region",...h("region",{required:"اختيار المنطقة مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",onChange:K,children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),E.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]}),r.region&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.region.message})]}),e.jsx("div",{className:"mb-4",children:e.jsx(le,{text:"اختر المحافظات",selected:H,items:N})}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{text:"اختر النجوم",selected:J,items:m})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"links",children:"روابط الإعلان"}),M.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"url",id:`link-${s}`,...h(`links.${s}.url`),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",placeholder:`رابط ${s+1}`}),e.jsx("button",{type:"button",onClick:()=>W(s),className:"p-2 text-white bg-red-500 rounded hover:bg-red-700",children:"حذف"})]},t.id)),e.jsx("button",{type:"button",onClick:()=>Q({url:""}),className:"p-2 mt-2 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة رابط جديد"})]})]})]}),_?e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!0,children:"جاري الإضافة..."}):e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة الإعلان"})]}),e.jsx(re,{position:"top-center",reverseOrder:!1})]})};export{ge as default};
