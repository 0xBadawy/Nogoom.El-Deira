import{c as ae,r as i,b as re,j as e,e as E,s as G,f as V,h as I}from"./index-Qhtfuz3P.js";import{u as le,a as oe}from"./index.esm-CbUVYW22.js";import{C as ne}from"./CheckboxList-BLDJcGim.js";import{G as P}from"./data-BQug-B3m.js";import{C as de}from"./CheckboxListName-KvdbMAyn.js";import{I as ie,_ as b}from"./index-DE0r-VE5.js";const pe=()=>{const{allUsers:f,addADs:q}=ae(),[p,j]=i.useState([]),[A,B]=i.useState(),{getUserEmail:N}=re(),[x,k]=i.useState([]);i.useState(null);const[v,y]=i.useState([]),[w,U]=i.useState([]),[D,F]=i.useState(0),[R,T]=i.useState(0),[_,m]=i.useState(!1),{register:g,handleSubmit:W,control:z,reset:H,setValue:ce,formState:{errors:l}}=le(),[J,S]=i.useState(""),M=(t,s)=>{const a=new Date(t),n=new Date(s);return!(a>n)},[L,$]=i.useState([]),O=t=>{const s={...t,governorates:x,stars:v,images:L.length>0?L:["https://firebasestorage.googleapis.com/v0/b/nogoomel-deira.firebasestorage.app/o/Website%20Images%2FScreenshot_5.png?alt=media&token=e314b8df-858e-4092-b3fe-920473f514e9"],video:J,views:0};if(console.log(s),t.startDate&&t.endDate&&!M(t.startDate,t.endDate)){b.error("تاريخ البداية يجب ان يكون قبل تاريخ النهاية");return}if(x.length===0){b.error("يجب اختيار المحافظة");return}if(v.length===0){b.error("يجب اختيار النجوم");return}q(s),$([]),S(""),H(),b.success("تم إضافة  حملة بنجاح!")},K=(t,s)=>{k(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})},Q=(t,s)=>{y(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})};i.useEffect(()=>{y([]);const t=f.filter(s=>s.role==="star"&&s.area.some(a=>x.includes(a)));U(t.map(s=>s.name)),U(t.map(s=>({name:s.name,Uid:s.Uid})))},[f,A,x]);const X=t=>{k([]),j([]),B(t.target.value),(()=>{const a=t.target.value,n=P.find(o=>o.name===a);j(n.subGovernments)})()},{fields:Y,append:Z,remove:ee}=oe({control:z,name:"links"}),se=t=>{const s=event.target.files;console.log("Files:",s);const a=["image/jpeg","image/png","image/gif","image/bmp","image/webp"];for(let o=0;o<s.length;o++){const c=s[o];if(console.log("File type:",c.type),a.includes(c.type))console.log("Valid file type:",c.type);else{console.log("Invalid file type detected:",c.type),alert("نوع الصورة غير مدعوم. يرجى رفع ملف بصيغة JPEG أو PNG أو GIF أو BMP أو WEBP."),m(!1);return}}m(!0),F(0);const n=t.target.files;n.length&&Array.from(n).forEach(o=>{let c="noUser";const r=N();r&&(c=r);const u=E(G,`${c}/images/${o.name}`),C=V(u,o);C.on("state_changed",d=>{const h=d.bytesTransferred/d.totalBytes*100;switch(console.log(`Upload progress for ${o.name}: ${h.toFixed(2)}%`),F(h),d.state){case"paused":console.log(`Upload for ${o.name} is paused`);break;case"running":console.log(`Upload for ${o.name} is running`);break}},d=>{switch(console.error(`Upload failed for ${o.name}:`,d.message),d.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",d.serverResponse);break}m(!1)},async()=>{try{const d=await I(C.snapshot.ref);console.log(`File available at ${d}`),$(h=>[...h,d])}catch(d){console.error("Error getting download URL:",d)}m(!1)})})},te=t=>{m(!0);const s=t.target.files[0];if(!s){console.error("No video selected");return}if(!s.type.startsWith("video/")){alert("نوع الملف غير مدعوم. يرجى رفع ملف بصيغة فيديو."),m(!1);return}let a="noUser";const n=N();n&&(a=n);const o=E(G,`${a}/videos/${s.name}`),c=V(o,s);c.on("state_changed",r=>{const u=r.bytesTransferred/r.totalBytes*100;switch(console.log(`Upload progress: ${u.toFixed(2)}%`),T(u),r.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},r=>{switch(console.error("Upload failed:",r.message),r.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",r.serverResponse);break}m(!1)},async()=>{try{const r=await I(c.snapshot.ref);console.log("Video available at",r),S(r)}catch(r){console.error("Error getting download URL:",r)}m(!1)})};return e.jsxs("div",{className:"p-2 md:p-8 dark:bg-gray-800",children:[e.jsxs("h2",{className:"text-2xl mb-4 text-gray-800  font-bold",children:["اضافة حملة جديدة"," "]}),e.jsxs("form",{onSubmit:W(O),className:"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 ",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 grid grid-cols-6 gap-3",children:[e.jsxs("div",{className:"mb-4 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"title",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",...g("title",{required:"عنوان الإعلان مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.title.message})]}),e.jsxs("div",{className:"mb-4 col-span-6 ",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"description",children:"نص الإعلان"}),e.jsx("textarea",{id:"description",...g("description",{required:"نص الإعلان مطلوب"}),className:"w-full h-52 p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.description.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-3 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx("input",{type:"date",id:"startDate",...g("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.startDate.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-3 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",id:"endDate",...g("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),l.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.endDate.message})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"images",children:[e.jsx("span",{className:"material-icons text-blue-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"صور الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"images",onChange:se,multiple:!0,className:"hidden"}),e.jsx("label",{htmlFor:"images",className:"w-full p-4 border-2 border-dashed border-blue-400 rounded-lg cursor-pointer bg-blue-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-blue-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-blue-400 text-2xl",children:"اضغط لتحميل الصور"}),e.jsx("p",{className:"mt-2 text-blue-600 dark:text-gray-300"})]})})]}),l.images&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.images.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-blue-400 to-blue-600 rounded-full transition-all",style:{width:`${D}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",D.toFixed(2),"%"]})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"video",children:[e.jsx("span",{className:"material-icons text-red-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"فيديو الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"video",onChange:te,className:"hidden"}),e.jsx("label",{htmlFor:"video",className:"w-full p-4 border-2 border-dashed border-red-400 rounded-lg cursor-pointer bg-red-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-red-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-red-400 text-2xl",children:"اضغط لتحميل الفيديو"}),e.jsx("p",{className:"mt-2 text-red-600 dark:text-gray-300"})]})})]}),l.video&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:l.video.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 via-red-400 to-red-600 rounded-full transition-all",style:{width:`${R}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",R.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"md:col-span-2 col-span-6 ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"region",children:"اختر المنطقة"}),e.jsxs("select",{id:"region",...g("region",{required:"اختيار المنطقة مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",onChange:X,children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),P.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]}),l.region&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.region.message})]}),p.length>0?e.jsx("div",{className:"mb-4",children:e.jsx(ne,{text:"اختر المحافظات",selected:K,items:p})}):e.jsxs("div",{children:[e.jsx("h6",{className:"mt-10  font-semibold text-black",children:"اختيار المحافظات"}),e.jsx("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:"يجب تحديد المنطقة أولًا"})})]}),w.length>0?e.jsx("div",{className:"mb-4",children:e.jsx(de,{text:"اختر النجوم",selected:Q,items:w})}):e.jsxs("div",{children:[e.jsx("h6",{className:"mt-10 font-semibold text-black",children:"اختيار النجوم"}),e.jsx("div",{className:"p-4 bg-red-50 rounded-lg text-center",children:e.jsx("p",{className:"text-sm text-gray-600",children:p.length<=0?"يجب اختيار المنطقة والمحافظات اولا":"لا يوجد نجوم متاحين فى المحافظات المحددة"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"links",children:"روابط الإعلان"}),Y.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"url",id:`link-${s}`,...g(`links.${s}.url`),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",placeholder:`رابط ${s+1}`}),e.jsx("button",{type:"button",onClick:()=>ee(s),className:"p-2 text-white bg-red-500 rounded hover:bg-red-700",children:"حذف"})]},t.id)),e.jsx("button",{type:"button",onClick:()=>Z({url:""}),className:"p-2 mt-2 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة رابط جديد"})]})]})]}),_?e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!0,children:"جاري الإضافة..."}):e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة الإعلان"})]}),e.jsx(ie,{position:"top-center",reverseOrder:!1})]})};export{pe as default};
