import{r as d,j as e,c as se,b as te,e as V,s as E,f as G,h as I}from"./index-BOx4tXWN.js";import{u as ae,a as re}from"./index.esm-XTVrE9B6.js";import{G as P}from"./data-DpX12Emc.js";import{C as le}from"./CheckboxListName-CPozegX9.js";import{I as oe,_}from"./index-CUfwLo9Z.js";const ne=({items:m,selected:k,text:U})=>{const[u,f]=d.useState({}),D=i=>{f(g=>{const h={...g,[i]:!g[i]};return k(m[i],h[i]),h})};d.useEffect(()=>{f({})},[m]);const N=()=>{const i=Object.keys(u).length===m.length&&Object.values(u).every(Boolean),g=m.reduce((h,C,j)=>(h[j]=!i,k(m[j],!i),h),{});f(g)},F=Object.keys(u).length===m.length&&Object.values(u).every(Boolean);return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:U}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:F,onChange:N,className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800  px-3",children:"تحديد الكل"})]}),m.map((i,g)=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:!!u[g],onChange:()=>D(g),className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"text-gray-800 px-3",children:i})]},g))]})]})},ue=()=>{const{allUsers:m,addADs:k}=se(),[U,u]=d.useState([]),{getUserEmail:f}=te(),[D,N]=d.useState([]);d.useState(null);const[F,i]=d.useState([]),[g,h]=d.useState([]),[C,j]=d.useState(0),[S,B]=d.useState(0),[A,p]=d.useState(!1),{register:b,handleSubmit:T,control:q,reset:O,setValue:de,formState:{errors:r}}=ae(),[M,R]=d.useState(""),W=(t,s)=>{const a=new Date(t),n=new Date(s);return!(a>n)},[L,$]=d.useState([]),z=t=>{const s={...t,governorates:D,stars:F,images:L.length>0?L:["https://firebasestorage.googleapis.com/v0/b/nogoomel-deira.firebasestorage.app/o/Website%20Images%2FScreenshot_5.png?alt=media&token=e314b8df-858e-4092-b3fe-920473f514e9"],video:M,views:0};if(console.log(s),t.startDate&&t.endDate&&!W(t.startDate,t.endDate)){_.error("تاريخ البداية يجب ان يكون قبل تاريخ النهاية");return}k(s),$([]),R(""),O(),_.success("تم إضافة  حملة بنجاح!")},H=(t,s)=>{N(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})},J=(t,s)=>{i(a=>{if(s){if(!a.includes(t))return[...a,t]}else return a.filter(n=>n!==t);return a})};d.useEffect(()=>{const t=m.filter(s=>s.role==="star");h(t.map(s=>s.name)),h(t.map(s=>({name:s.name,Uid:s.Uid})))},[m]);const K=t=>{N([]),u([]),(()=>{const a=t.target.value,n=P.find(l=>l.name===a);u(n.subGovernments)})()},{fields:Q,append:X,remove:Y}=re({control:q,name:"links"}),Z=t=>{const s=event.target.files;console.log("Files:",s);const a=["image/jpeg","image/png","image/gif","image/bmp","image/webp"];for(let l=0;l<s.length;l++){const x=s[l];if(console.log("File type:",x.type),a.includes(x.type))console.log("Valid file type:",x.type);else{console.log("Invalid file type detected:",x.type),alert("نوع الصورة غير مدعوم. يرجى رفع ملف بصيغة JPEG أو PNG أو GIF أو BMP أو WEBP."),p(!1);return}}p(!0),j(0);const n=t.target.files;n.length&&Array.from(n).forEach(l=>{let x="noUser";const v=f();v&&(x=v);const o=V(E,`${x}/images/${l.name}`),y=G(o,l);y.on("state_changed",c=>{const w=c.bytesTransferred/c.totalBytes*100;switch(console.log(`Upload progress for ${l.name}: ${w.toFixed(2)}%`),j(w),c.state){case"paused":console.log(`Upload for ${l.name} is paused`);break;case"running":console.log(`Upload for ${l.name} is running`);break}},c=>{switch(console.error(`Upload failed for ${l.name}:`,c.message),c.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",c.serverResponse);break}p(!1)},async()=>{try{const c=await I(y.snapshot.ref);console.log(`File available at ${c}`),$(w=>[...w,c])}catch(c){console.error("Error getting download URL:",c)}p(!1)})})},ee=t=>{p(!0);const s=t.target.files[0];if(!s){console.error("No video selected");return}if(!["video/mp4","video/webm","video/ogg","video/avi","video/mkv"].includes(s.type)){alert("نوع الفيديو غير مدعوم. يرجى رفع ملف بصيغة MP4 أو WEBM أو OGG أو AVI أو MKV."),p(!1);return}let n="noUser";const l=f();l&&(n=l);const x=V(E,`${n}/videos/${s.name}`),v=G(x,s);v.on("state_changed",o=>{const y=o.bytesTransferred/o.totalBytes*100;switch(console.log(`Upload progress: ${y.toFixed(2)}%`),B(y),o.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},o=>{switch(console.error("Upload failed:",o.message),o.code){case"storage/unauthorized":console.error("User does not have permission to access the object");break;case"storage/canceled":console.error("User canceled the upload");break;case"storage/unknown":console.error("Unknown error occurred",o.serverResponse);break}p(!1)},async()=>{try{const o=await I(v.snapshot.ref);console.log("Video available at",o),R(o)}catch(o){console.error("Error getting download URL:",o)}p(!1)})};return e.jsxs("div",{className:"p-2 md:p-8 dark:bg-gray-800",children:[e.jsxs("h2",{className:"text-2xl mb-4 text-gray-800  font-bold",children:["اضافة حملة جديدة"," "]}),e.jsxs("form",{onSubmit:T(z),className:"bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 ",children:[e.jsxs("div",{className:"md:col-span-3 col-span-6 grid grid-cols-6 gap-3",children:[e.jsxs("div",{className:"mb-4 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"title",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",...b("title",{required:"عنوان الإعلان مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.title&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.title.message})]}),e.jsxs("div",{className:"mb-4 col-span-6 ",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"description",children:"نص الإعلان"}),e.jsx("textarea",{id:"description",...b("description",{required:"نص الإعلان مطلوب"}),className:"w-full h-52 p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.description&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.description.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"category",children:"اختر نوع الإعلان"}),e.jsxs("select",{id:"category",...b("category",{required:"اختيار النوع مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",children:[e.jsx("option",{value:"",children:"اختر نوعًا"}),e.jsx("option",{value:"events",children:"مناسبات"}),e.jsx("option",{value:"real_estate",children:"عقارات"}),e.jsx("option",{value:"cars",children:"سيارات"}),e.jsx("option",{value:"electronics",children:"إلكترونيات"}),e.jsx("option",{value:"services",children:"خدمات"}),e.jsx("option",{value:"home_supplies",children:"لوازم منزلية"}),e.jsx("option",{value:"personal_supplies",children:"لوازم شخصية"}),e.jsx("option",{value:"animals",children:"حيوانات"})]}),r.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.category.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"startDate",children:"تاريخ البداية"}),e.jsx("input",{type:"date",id:"startDate",...b("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.startDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.startDate.message})]}),e.jsxs("div",{className:"mb-4 md:col-span-2 col-span-6",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"endDate",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",id:"endDate",...b("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white"}),r.endDate&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.endDate.message})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"images",children:[e.jsx("span",{className:"material-icons text-blue-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"صور الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"images",onChange:Z,multiple:!0,className:"hidden"}),e.jsx("label",{htmlFor:"images",className:"w-full p-4 border-2 border-dashed border-blue-400 rounded-lg cursor-pointer bg-blue-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-blue-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-blue-400 text-2xl",children:"اضغط لتحميل الصور"}),e.jsx("p",{className:"mt-2 text-blue-600 dark:text-gray-300"})]})})]}),r.images&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:r.images.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 via-blue-400 to-blue-600 rounded-full transition-all",style:{width:`${C}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",C.toFixed(2),"%"]})]}),e.jsxs("div",{className:"mb-8 md:col-span-2 col-span-6",children:[e.jsxs("label",{className:"block text-lg font-semibold text-gray-800 dark:text-white mb-4 flex items-center gap-3",htmlFor:"video",children:[e.jsx("span",{className:"material-icons text-red-600 text-3xl"}),e.jsx("span",{className:"flex-1",children:"فيديو الإعلان"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",id:"video",onChange:ee,className:"hidden"}),e.jsx("label",{htmlFor:"video",className:"w-full p-4 border-2 border-dashed border-red-400 rounded-lg cursor-pointer bg-red-50 dark:bg-gray-800 dark:border-gray-600 hover:bg-red-100 dark:hover:bg-gray-700 flex items-center justify-center transition-all",children:e.jsxs("span",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"material-icons text-red-400 text-2xl",children:"اضغط لتحميل الفيديو"}),e.jsx("p",{className:"mt-2 text-red-600 dark:text-gray-300"})]})})]}),r.video&&e.jsx("p",{className:"text-red-500 text-sm mt-3",children:r.video.message}),e.jsx("div",{className:"relative w-full mt-5 h-3 bg-gray-300 rounded-full dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-red-500 via-red-400 to-red-600 rounded-full transition-all",style:{width:`${S}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["نسبة التحميل: ",S.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"md:col-span-2 col-span-6 ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"region",children:"اختر المنطقة"}),e.jsxs("select",{id:"region",...b("region",{required:"اختيار المنطقة مطلوب"}),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",onChange:K,children:[e.jsx("option",{value:"",children:"اختر المنطقة"}),P.map((t,s)=>e.jsx("option",{value:t.name,children:t.name},s))]}),r.region&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.region.message})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ne,{text:"اختر المحافظات",selected:H,items:U})}),e.jsx("div",{className:"mb-4",children:e.jsx(le,{text:"اختر النجوم",selected:J,items:g})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-800 dark:text-white mb-2",htmlFor:"links",children:"روابط الإعلان"}),Q.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"url",id:`link-${s}`,...b(`links.${s}.url`),className:"w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white",placeholder:`رابط ${s+1}`}),e.jsx("button",{type:"button",onClick:()=>Y(s),className:"p-2 text-white bg-red-500 rounded hover:bg-red-700",children:"حذف"})]},t.id)),e.jsx("button",{type:"button",onClick:()=>X({url:""}),className:"p-2 mt-2 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة رابط جديد"})]})]})]}),A?e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",disabled:!0,children:"جاري الإضافة..."}):e.jsx("button",{type:"submit",className:"w-full p-2 mt-4 text-white bg-blue-500 rounded hover:bg-blue-700",children:"إضافة الإعلان"})]}),e.jsx(oe,{position:"top-center",reverseOrder:!1})]})};export{ue as default};
