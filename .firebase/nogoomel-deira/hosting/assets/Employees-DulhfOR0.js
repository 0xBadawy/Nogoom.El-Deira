import{b as q,r as x,j as e,t as f,c as L}from"./index-_Ilj38vT.js";import{u as C}from"./index.esm-DuzlAj83.js";import"./index-DKeBPxb6.js";import{I as F,_ as D}from"./index-YxvnNNYc.js";import{D as O,a as $,b as M,c as A,d as B}from"./dialog-CmBY3N46.js";import{B as E}from"./button-B1TOWV_p.js";import"./index-Chjiymov.js";import"./index-Bqlb8ui7.js";import"./index-Bcvv0Bb8.js";import"./index-BnSShUBT.js";const H=()=>{const{register:r,handleSubmit:p,watch:c,reset:w,formState:{errors:n}}=C(),{signUp:t}=q(),[i,j]=x.useState(null),[v,N]=x.useState(!1);c("password");const h=a=>a.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":a.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.",[g,S]=x.useState(!1),y=()=>{S(!g)},U=async a=>{if(!/^\d{10,11}$/.test(a.phone)){f.error("يجب أن يكون رقم الهاتف مكوناً من 10 أو 11 رقماً ويتكون من أرقام فقط");return}if(!/^[a-zA-Z0-9]{3,15}$/.test(a.username)){f.error("يجب أن يكون اسم المستخدم مكوناً من 3 إلى 15 حرفاً ويمكن أن يحتوي على حروف وأرقام فقط");return}if(confirm("هل انت متأكد من إضافة هذا المستخدم؟")==!0)try{await b(a)}catch{f.error("حدث خطأ أثناء إضافة المستخدم.")}else f.error("تم إلغاء العملية")},b=async a=>{j(null),N(!0);try{const{email:d,password:o,role:s,...l}=a,m=await t(d,o,l,s);if(!m.success){j(h(m.error)),f.error("حدث خطأ أثناء إضافة المستخدم.");return}f.success("تم إضافة الموظف بنجاح!"),w()}catch(d){const o=d!=null&&d.code?h(d.code):"حدث خطأ غير متوقع!";j(o),console.error("Error during submission:",d.message||d)}finally{N(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:"إضافة موظف"}),e.jsxs("form",{onSubmit:p(U),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...r("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),n.name&&e.jsx("p",{className:"text-red-500 text-sm",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...r("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),n.email&&e.jsx("p",{className:"text-red-500 text-sm",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...r("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),n.username&&e.jsx("p",{className:"text-red-500 text-sm",children:n.username.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-1",children:[" ","رقم الهاتف"]}),e.jsx("input",{type:"text",...r("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),n.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:n.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",...r("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),e.jsx("button",{type:"button",onClick:y,className:"absolute left-2 top-2 text-gray-500",children:g?"إخفاء":"إظهار"})]}),n.password&&e.jsx("p",{className:"text-red-500 text-sm",children:n.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...r("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsxs("option",{value:"admin",children:[e.jsx("span",{children:"مدير"})," (كل الصلاحيات)"]}),e.jsxs("option",{value:"editor",children:[e.jsx("span",{children:"محرر"}),"(كل الصلاحيات عدا الموظفين والمحفظة)"]}),e.jsxs("option",{value:"viewer",children:[" ",e.jsx("span",{children:"مشاهد"})," (الدخول والمتابعة فقط)"]})]}),n.role&&e.jsx("p",{className:"text-red-500 text-sm",children:n.role.message})]}),e.jsx("div",{className:"flex flex-row",children:e.jsx("button",{type:"submit",disabled:v,className:"w-fit px-20 mx-auto bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-200",children:v?"جارٍ الحفظ...":"حفظ البيانات"})}),i&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:i})]})]})},I=({userData:r,onUserUpdated:p})=>{const{register:c,handleSubmit:w,setValue:n,reset:t,formState:{errors:i}}=C(),{signUp:j,updateUser:v}=q(),[N,h]=x.useState(null),[g,S]=x.useState(!1),y=a=>a.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":a.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.";x.useEffect(()=>{r?Object.keys(r).forEach(a=>{n(a,r[a])}):t()},[r,n,t]);const U=async a=>{const d=!!r;if(confirm(d?"هل أنت متأكد من تحديث بيانات المستخدم؟":"هل انت متأكد من إضافة هذا المستخدم؟"))try{await b(a,d),alert("تمت العملية بنجاح!")}catch(l){console.error("حدث خطأ أثناء العملية:",l),alert("حدث خطأ أثناء العملية.")}else D.error("تم إلغاء العملية")},b=async(a,d)=>{h(null),S(!0);try{const{email:o,password:s,role:l,...m}=a;if(d){const u=await v(r.Uid,{email:o,role:l,...m});if(!u.success){h(y(u.error));return}D.success("تم تحديث بيانات الموظف بنجاح!"),p&&p(u.data)}else{const u=await j(o,s,m,l);if(!u.success){h(y(u.error));return}D.success("تم إضافة الموظف بنجاح!"),t()}}catch(o){const s=o!=null&&o.code?y(o.code):"حدث خطأ غير متوقع!";h(s),console.error("Error during submission:",o.message||o)}finally{S(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:r?"تحديث بيانات الموظف":"إضافة موظف"}),e.jsxs("form",{onSubmit:w(U),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...c("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),i.name&&e.jsx("p",{className:"text-red-500 text-sm",children:i.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...c("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),i.email&&e.jsx("p",{className:"text-red-500 text-sm",children:i.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...c("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),i.username&&e.jsx("p",{className:"text-red-500 text-sm",children:i.username.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"text",...c("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),i.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:i.phone.message})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsx("input",{type:"password",...c("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),i.password&&e.jsx("p",{className:"text-red-500 text-sm",children:i.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...c("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsx("option",{value:"admin",children:"مدير"}),e.jsx("option",{value:"editor",children:"محرر"}),e.jsx("option",{value:"viewer",children:"مشاهد"})]}),i.role&&e.jsx("p",{className:"text-red-500 text-sm",children:i.role.message})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:g?"جارٍ الحفظ...":r?"تحديث البيانات":"حفظ البيانات"}),N&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:N})]}),e.jsx(F,{position:"top-center",reverseOrder:!1})]})},P=({children:r})=>e.jsx("span",{style:{position:"absolute",width:"1px",height:"1px",background:"white",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0},children:r}),V=({title:r="تأكيد العملية",message:p="هل أنت متأكد من الاستمرار؟",isOpen:c,onClose:w,onConfirm:n,onCancel:t})=>e.jsx("div",{className:"bg-white",children:e.jsx(O,{open:c,onOpenChange:w,children:e.jsxs($,{className:"bg-white",children:[e.jsxs(M,{children:[e.jsx(P,{children:e.jsx(A,{children:r})}),e.jsx("p",{children:p})]}),e.jsxs(B,{children:[e.jsx(E,{variant:"ghost",onClick:t,children:"إلغاء"}),e.jsx(E,{className:"text-white",onClick:n,children:"نعم"})]})]})})}),X=()=>{const[r,p]=x.useState([]),{allUsers:c,updateUser:w,deleteUserFromDB:n}=L(),[t,i]=x.useState(null),[j,v]=x.useState({}),[N,h]=x.useState(!1);x.useEffect(()=>{p(c),g()},[c]);const g=()=>{p(s=>s.sort((l,m)=>m.lastSeen-l.lastSeen))},S=()=>{h(!1),i(null)},y=()=>{const s=r.find(l=>l.Uid===t);v(s),h(!0)},[U,b]=x.useState(!1),a=s=>{b(!0)},d=()=>{n(t),i(null),g(),f.success("تم حذف الموظف بنجاح",{description:new Date().toLocaleString()}),b(!1)},o=()=>{b(!1),f.error("تم إلغاء العملية",{description:new Date().toLocaleString()})};return e.jsxs("div",{className:"grow md:p-8 p-2  dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"النجوم"}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 w-full max-w-screen overflow-x-auto",children:[e.jsx(H,{}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"قائمة المستخدمين "}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"py-2 px-4 text-right",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right hidden sm:table-cell",children:"البريد الإلكتروني"}),e.jsx("th",{className:"py-2 px-4 text-right hidden md:table-cell",children:"اخر ظهور"}),e.jsx("th",{className:"py-2 px-4 text-right",children:"الوظيفية"})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((s,l)=>{var m;return s.role!=="star"&&!s.isDeleted&&e.jsxs("tr",{onClick:()=>i(s.Uid),className:`border-b cursor-pointer ${s.Uid===t?"bg-gray-200":""} hover:bg-gray-100`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 hidden sm:table-cell",children:s.email}),e.jsx("td",{className:"py-2 px-4 hidden md:table-cell",children:e.jsx("p",{children:(m=s==null?void 0:s.lastSeen)==null?void 0:m.toDate().toLocaleString()})}),e.jsx("td",{className:"py-2 px-4",children:s.role==="admin"?"مدير":s.role==="editor"?"محرر":"مشاهد"})]},l)})})]})})]}),t&&e.jsx("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات المستخدم"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الاسم"}),e.jsx("span",{children:r.find(s=>s.Uid===t).name})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"البريد الإلكتروني"}),e.jsx("span",{children:r.find(s=>s.Uid===t).email})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"اسم المستخدم "}),e.jsx("span",{children:r.find(s=>s.Uid===t).username})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الوظيفة"}),e.jsx("span",{children:r.find(s=>s.Uid===t).role=="editor"?"محرر":r.find(s=>s.Uid===t).role=="admin"?"مدير":"مشاهد"})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"رقم الهاتف"}),e.jsx("span",{children:r.find(s=>s.Uid===t).phone})]})]}),e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ أخر ظهور"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.lastSeen;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ انشاء الحساب"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.createdAt;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded-lg",onClick:()=>a(),children:"حذف المستخدم"}),e.jsx(V,{title:"تأكيد الحذف",message:"هل متأكد من حذف هذا المستخدم؟",isOpen:U,onClose:()=>b(!1),onConfirm:d,onCancel:o}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg",onClick:y,children:"تعديل المستخدم"})]})]})})]}),e.jsxs("div",{className:`${N?"":"hidden"}`,children:[e.jsx(I,{userData:j,onUserUpdated:S}),";"]})]})};export{X as default};
