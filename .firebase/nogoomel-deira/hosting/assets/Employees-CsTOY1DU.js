import{b as q,r as x,j as e,t as U,c as L}from"./index-D1kJxIkH.js";import{u as C}from"./index.esm-CylbFJ5w.js";import"./index-gAEEqHr4.js";import{I as F,_ as D}from"./index-DUTVWf5v.js";import{D as O,a as M,b as $,c as B,d as H}from"./dialog-B5goFC3n.js";import{B as E}from"./button-DGMjbkUI.js";import"./index-Chjiymov.js";import"./index-CIo6qUwL.js";import"./index-BXLg_uEm.js";import"./index-Cc2IEVgW.js";const I=()=>{const{register:r,handleSubmit:g,watch:d,reset:w,formState:{errors:a}}=C(),{signUp:t}=q(),[n,j]=x.useState(null),[v,N]=x.useState(!1);d("password");const h=m=>m.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":m.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.",y=async m=>{if(confirm("هل انت متأكد من إضافة هذا المستخدم؟")==!0)try{await S(m),U.success("تم إضافة المستخدم بنجاح!")}catch{U.error("حدث خطأ أثناء إضافة المستخدم.")}else U.error("تم إلغاء العملية")},S=async m=>{j(null),N(!0);try{const{email:c,password:p,role:o,...f}=m,i=await t(c,p,f,o);if(!i.success){j(h(i.error));return}U.success("تم إضافة الموظف بنجاح!"),w()}catch(c){const p=c!=null&&c.code?h(c.code):"حدث خطأ غير متوقع!";j(p),console.error("Error during submission:",c.message||c)}finally{N(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:"إضافة موظف"}),e.jsxs("form",{onSubmit:g(y),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...r("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...r("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),a.email&&e.jsx("p",{className:"text-red-500 text-sm",children:a.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...r("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),a.username&&e.jsx("p",{className:"text-red-500 text-sm",children:a.username.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-1",children:[" ","رقم الهاتف"]}),e.jsx("input",{type:"text",...r("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),a.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:a.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsx("input",{type:"password",...r("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),a.password&&e.jsx("p",{className:"text-red-500 text-sm",children:a.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...r("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsxs("option",{value:"admin",children:[e.jsx("span",{children:"مدير"})," (كل الصلاحيات)"]}),e.jsxs("option",{value:"editor",children:[e.jsx("span",{children:"محرر"}),"(كل الصلاحيات عدا المديرين والمحفظة)"]}),e.jsxs("option",{value:"viewer",children:[" ",e.jsx("span",{children:"مشاهد"})," (الدخول والمتابعة فقط)"]})]}),a.role&&e.jsx("p",{className:"text-red-500 text-sm",children:a.role.message})]}),e.jsx("button",{type:"submit",disabled:v,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:v?"جارٍ الحفظ...":"حفظ البيانات"}),n&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:n})]})]})},A=({userData:r,onUserUpdated:g})=>{const{register:d,handleSubmit:w,setValue:a,reset:t,formState:{errors:n}}=C(),{signUp:j,updateUser:v}=q(),[N,h]=x.useState(null),[y,S]=x.useState(!1),m=o=>o.includes("auth/email-already-in-use")?"هذا البريد الإلكتروني مستخدم بالفعل.":o.includes("auth/weak-password")?"كلمة المرور ضعيفة جدًا. يجب أن تحتوي على 6 أحرف على الأقل.":"حدث خطأ غير معروف. الرجاء المحاولة مرة أخرى.";x.useEffect(()=>{r?Object.keys(r).forEach(o=>{a(o,r[o])}):t()},[r,a,t]);const c=async o=>{const f=!!r;if(confirm(f?"هل أنت متأكد من تحديث بيانات المستخدم؟":"هل انت متأكد من إضافة هذا المستخدم؟"))try{await p(o,f),alert("تمت العملية بنجاح!")}catch(l){console.error("حدث خطأ أثناء العملية:",l),alert("حدث خطأ أثناء العملية.")}else D.error("تم إلغاء العملية")},p=async(o,f)=>{h(null),S(!0);try{const{email:i,password:s,role:l,...b}=o;if(f){const u=await v(r.Uid,{email:i,role:l,...b});if(!u.success){h(m(u.error));return}D.success("تم تحديث بيانات الموظف بنجاح!"),g&&g(u.data)}else{const u=await j(i,s,b,l);if(!u.success){h(m(u.error));return}D.success("تم إضافة الموظف بنجاح!"),t()}}catch(i){const s=i!=null&&i.code?m(i.code):"حدث خطأ غير متوقع!";h(s),console.error("Error during submission:",i.message||i)}finally{S(!1)}};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:r?"تحديث بيانات الموظف":"إضافة موظف"}),e.jsxs("form",{onSubmit:w(c),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...d("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),n.name&&e.jsx("p",{className:"text-red-500 text-sm",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...d("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),n.email&&e.jsx("p",{className:"text-red-500 text-sm",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"اسم المستخدم"}),e.jsx("input",{type:"text",...d("username",{required:"اسم المستخدم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل اسم المستخدم"}),n.username&&e.jsx("p",{className:"text-red-500 text-sm",children:n.username.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"text",...d("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),n.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:n.phone.message})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsx("input",{type:"password",...d("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),n.password&&e.jsx("p",{className:"text-red-500 text-sm",children:n.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...d("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsx("option",{value:"admin",children:"مدير"}),e.jsx("option",{value:"editor",children:"محرر"}),e.jsx("option",{value:"viewer",children:"مشاهد"})]}),n.role&&e.jsx("p",{className:"text-red-500 text-sm",children:n.role.message})]}),e.jsx("button",{type:"submit",disabled:y,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:y?"جارٍ الحفظ...":r?"تحديث البيانات":"حفظ البيانات"}),N&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:N})]}),e.jsx(F,{position:"top-center",reverseOrder:!1})]})},V=({children:r})=>e.jsx("span",{style:{position:"absolute",width:"1px",height:"1px",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0},children:r}),_=({title:r="تأكيد العملية",message:g="هل أنت متأكد من الاستمرار؟",isOpen:d,onClose:w,onConfirm:a,onCancel:t})=>e.jsx("div",{children:e.jsx(O,{open:d,onOpenChange:w,children:e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(V,{children:e.jsx(B,{children:r})}),e.jsx("p",{children:g})]}),e.jsxs(H,{children:[e.jsx(E,{variant:"ghost",onClick:t,children:"إلغاء"}),e.jsx(E,{onClick:a,children:"نعم"})]})]})})}),Y=()=>{const[r,g]=x.useState([]),{allUsers:d,updateUser:w,deleteUserFromDB:a}=L(),[t,n]=x.useState(null),[j,v]=x.useState({}),[N,h]=x.useState(!1);x.useEffect(()=>{g(d),y()},[d]);const y=()=>{g(s=>s.sort((l,b)=>b.lastSeen-l.lastSeen))},S=()=>{h(!1),n(null)},m=()=>{const s=r.find(l=>l.Uid===t);v(s),h(!0)},[c,p]=x.useState(!1),o=s=>{p(!0)},f=()=>{a(t),n(null),y(),U.success("تم حذف الموظف بنجاح",{description:new Date().toLocaleString()}),p(!1)},i=()=>{p(!1),U.error("تم إلغاء العملية",{description:new Date().toLocaleString()})};return e.jsxs("div",{className:"grow md:p-8 p-3 dark:bg-gray-800",children:[e.jsx("h2",{className:"text-2xl w-full mb-4 text-",children:"صفحة ادارة الموظفين "}),e.jsxs("div",{children:[e.jsx(I,{}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"قائمة المستخدمين "}),e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-4 text-right",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right hidden md:table-cell",children:"البريد الإلكتروني"}),e.jsxs("th",{className:"py-2 px-4 text-right  md:table-cell",children:["اخر ظهور"," "]}),e.jsx("th",{className:"py-2 px-4 text-right ",children:"الوظيفية"})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((s,l)=>{var b;return s.role!="star"&&!s.isDeleted&&e.jsxs("tr",{onClick:()=>n(s.Uid),className:`border-b ${s.Uid===t?"bg-gray-200":""}`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 hidden md:table-cell",children:s.email}),e.jsx("td",{className:"py-2 px-4  md:table-cell",children:e.jsx("p",{children:(b=s==null?void 0:s.lastSeen)==null?void 0:b.toDate().toLocaleString()})}),e.jsx("td",{className:"py-2 px-4 ",children:s.role==="admin"?"مدير":s.role==="editor"?"محرر":"مشاهد"})]},l)})})]})]}),t&&e.jsx("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات المستخدم"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الاسم"}),e.jsx("span",{children:r.find(s=>s.Uid===t).name})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"البريد الإلكتروني"}),e.jsx("span",{children:r.find(s=>s.Uid===t).email})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"اسم المستخدم "}),e.jsx("span",{children:r.find(s=>s.Uid===t).username})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"الوظيفة"}),e.jsx("span",{children:r.find(s=>s.Uid===t).role=="editor"?"محرر":r.find(s=>s.Uid===t).role=="admin"?"مدير":"مشاهد"})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"رقم الهاتف"}),e.jsx("span",{children:r.find(s=>s.Uid===t).phone})]})]}),e.jsxs("div",{className:"md:w-1/2",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ أخر ظهور"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.lastSeen;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:"تاريخ انشاء الحساب"}),e.jsx("span",{children:(()=>{var u;const s=r.find(k=>k.Uid===t),l=s==null?void 0:s.createdAt;return l?(((u=l.toDate)==null?void 0:u.call(l))||(typeof l=="number"?new Date(l):l)).toLocaleString():"غير متاح"})()})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded-lg",onClick:()=>o(),children:"حذف المستخدم"}),e.jsx(_,{title:"تأكيد الحذف",message:"هل متأكد من حذف هذا المستخدم؟",isOpen:c,onClose:()=>p(!1),onConfirm:f,onCancel:i}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg",onClick:m,children:"تعديل المستخدم"})]})]})})]}),e.jsxs("div",{className:`${N?"":"hidden"}`,children:[e.jsx(A,{userData:j,onUserUpdated:S}),";"]})]})};export{Y as default};
