import{b as G,r as n,j as e,f as B,s as M,g as E,h as O,c as $,e as T,k as z}from"./index-BRyFHO37.js";import{u as q,C as I}from"./index.esm-DSfORUPq.js";import{C as J,a as H,b as V,c as W}from"./card-DtWT036_.js";import{L,I as P}from"./textarea-Crt7T1Jl.js";import{B as K}from"./button-BGDz5B5J.js";import{D as Q,k as x}from"./index-Cx7eOxQ9.js";import{A as X}from"./AreaGovernmentSelector-CEUsC5dp.js";import{G as R}from"./data-Csv9xAeZ.js";import{U as Y}from"./UserDetailsBalance-DQpz-AN7.js";import{G as Z}from"./iconBase-BnnEYh8x.js";import"./index-B7VwfHaV.js";import"./index-B_CdpRr_.js";import"./data-CyOksF0G.js";import"./index-uKrELWh1.js";import"./index-B523pwie.js";import"./index-ChnqpQ_x.js";import"./index-DM259MX_.js";const ee=({selectedUserUid:c,usersData:p})=>{const{updateUser:D}=G(),[w,d]=n.useState({}),[F,f]=n.useState({}),[j,b]=n.useState(""),{control:m,handleSubmit:k,setValue:i}=q(),[g,y]=n.useState({}),[v,N]=n.useState(0),[S,h]=n.useState([]);n.useEffect(()=>{var t,r;const a=p.find(s=>s._id===c);console.log(a),a&&(d(a),f({area:((t=a.address)==null?void 0:t.area)||"",governments:((r=a.address)==null?void 0:r.govern)||[]}),h(a.social||[]),i("name",a.name),i("phone",a.phone),i("bio",a.bio),i("email",a.email),b(a.profileImage||""),console.log(a.profileImage||""))},[c,p,i]);const _=(a,t)=>{const r=[...S];r[a].link=t,h(r)},A=async a=>{const t={...a,selectedAddress:g,profileImage:j,verified:!1,socialLinks:S};try{const r=await $.put(`/user/update_user/${c}`,t);await D(r.data.data),x.success("تم حفظ التعديلات بنجاح"),console.log(r.data)}catch(r){console.error("خطأ في تحديث البيانات:",r),x.error("فشل في تحديث البيانات")}},u=({selectedArea:a,selectedGovernments:t})=>{y(r=>r.area===a&&JSON.stringify(r.govern)===JSON.stringify(t)?r:{area:a,govern:t})},C=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){x.error("يرجى رفع ملف صورة فقط.");return}if(t.size>2*1024*1024){x.error("حجم الصورة كبير جدًا. الحد الأقصى هو 2 ميغابايت.");return}N(0);const r=w.email||"noUser",s=B(M,`${r}/profile/${t.name}`),l=E(s,t);l.on("state_changed",o=>{const U=o.bytesTransferred/o.totalBytes*100;N(U)},o=>{x.error("خطأ أثناء رفع الصورة."),console.error("خطأ أثناء رفع الصورة:",o)},async()=>{try{const o=await O(l.snapshot.ref);b(o),N(0),x.success("تم رفع الصورة بنجاح.")}catch(o){console.error("خطأ في الحصول على رابط التنزيل:",o)}})};return e.jsxs(J,{children:[e.jsx(H,{children:e.jsx(V,{className:"text-3xl font-bold text-indigo-900 mt-10",children:"إعدادات الحساب"})}),e.jsxs(W,{children:[e.jsx("p",{className:"mb-6 text-gray-600",children:"يمكنك هنا تحديث بيانات حسابك بما في ذلك التفاصيل الشخصية وصورتك الشخصية."}),e.jsxs("form",{onSubmit:k(A),className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx(I,{name:"profilePicture",control:m,render:({field:a})=>e.jsx("img",{className:"object-cover w-32 h-32 rounded-full ring-4 ring-indigo-300 mb-4",src:j||w.profileImage||"https://via.placeholder.com/150",alt:"Profile"})}),e.jsxs(L,{htmlFor:"profilePicture",className:"cursor-pointer",children:[e.jsx("span",{className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300",children:"تغيير الصورة الشخصية"}),e.jsx(P,{id:"profilePicture",type:"file",accept:"image/*",onChange:C,className:"hidden"}),v!==0&&e.jsx("div",{className:"relative w-full mt-4 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${v}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"name",children:"اسم الشهرة او الحساب*"}),e.jsx(I,{name:"name",control:m,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"البريد الإلكتروني* "}),e.jsx(I,{name:"email",control:m,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"phone",children:"رقم الهاتف*"}),e.jsx(I,{name:"phone",control:m,rules:{required:"رقم الهاتف مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("label",{htmlFor:"",children:"التواصل الاجتماعي"}),S.map((a,t)=>(a.link||a.label)&&e.jsx("div",{className:"space-y- col-span-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 text-gray-800 flex items-center justify-between",children:e.jsx("input",{type:"url",value:a.link||"",onChange:r=>_(t,r.target.value),className:"w-full bg-gray-100 border-none focus:ring-0",placeholder:`أدخل الرابط لـ ${a.label||"التواصل الاجتماعي"}`})})},t))]}),e.jsx(X,{initialData:F,onSelectionChange:u})]}),e.jsx(K,{type:"submit",className:"w-full text-white",children:"حفظ التغييرات"})]})]}),e.jsx(Q,{position:"top-center",reverseOrder:!1})]})};function se(c){return Z({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"},child:[]}]})(c)}const be=()=>{var r;const[c,p]=n.useState([]),{allUsers:D,updateUser:w}=T(),[d,F]=n.useState("all"),[f,j]=n.useState("all"),{user:b}=G();console.log("User:",b.role);const{id:m}=z();n.useEffect(()=>{if(m&&c.length>0){const s=c.find(l=>l._id===m);s&&C(s._id)}},[m,c]);const k=c.filter(s=>{var U;const l=d==="all"||s.address.area===d,o=f==="all"||((U=s.address.govern)==null?void 0:U.includes(f));return l&&o}),[i,g]=n.useState(1),y=20,v=i*y,N=v-y,S=k.slice(N,v),h=Math.ceil(k.length/y),[_,A]=n.useState("");n.useEffect(()=>{(async()=>{try{const l=await $.get("/user/all_users");p(l.data.data)}catch(l){console.log(l)}})()},[D]);const[u,C]=n.useState(null),a=s=>{p(l=>l.map(o=>o._id===s._id?s:o)),w(s)},t=s=>{switch(s){case"none":return"transparent";case"silver":return"text-white";case"gold":return"text-yellow-500";case"bronze":return"text-yellow-200";default:return""}};return e.jsxs("div",{className:"grow md:p-8 p-2  dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"النجوم"}),e.jsxs("div",{className:"my-6  bg-white  dark:bg-gray-800 rounded-lg shadow-md p-4 w-fit full max-w-screen overflow-x-auto",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex gap-4 mb-4 flex-col md:flex-col",children:[e.jsxs("select",{value:d,onChange:s=>{F(s.target.value),g(1),j("all")},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"كل المناطق"}),R.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:f,onChange:s=>{j(s.target.value),g(1)},className:"border rounded px-2 py-1",disabled:d==="all",children:[e.jsx("option",{value:"all",children:"كل المحافظات"}),d!=="all"&&((r=R.find(s=>s.name===d))==null?void 0:r.subGovernments.map(s=>e.jsx("option",{value:s,children:s},s)))]})]})}),e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات النجوم"}),e.jsxs("table",{className:"table-auto w-fit  text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-1 text-right min-w-36 ",children:"الاسم"}),e.jsx("th",{className:"py-2 px-1 text-right",children:"فئة النجم"})]})}),e.jsx("tbody",{children:S.map((s,l)=>s.role==="star"&&e.jsxs("tr",{onClick:()=>C(s._id),className:`border-b hover:bg-gray-100 dark:hover:bg-gray-700 ${s._id===u?"bg-gray-200 dark:bg-gray-600":""}`,children:[e.jsx("td",{className:"py-2 px-1",children:s.name}),e.jsx("td",{className:"py2 px4 flex items-center gap-2 ",children:s.accountType!=="none"&&e.jsx(se,{className:t(s.accountType),size:24})})]},l))})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>g(s=>Math.max(s-1,1)),disabled:i===1,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"السابق"}),Array.from({length:h},(s,l)=>e.jsx("button",{onClick:()=>g(l+1),className:`px-4 py-2 mx-1 rounded-lg ${i===l+1?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:l+1},l)),e.jsx("button",{onClick:()=>g(s=>Math.min(s+1,h)),disabled:i===h,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"التالي"})]})]}),u&&e.jsx(ee,{selectedUserUid:u,usersData:c,onSave:a}),u&&b.role!=="viewer"&&e.jsx(Y,{selectedUserUid:u,usersData:c,onSave:a})]})};export{be as default};
