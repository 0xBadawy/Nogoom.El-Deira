import{b as T,r as l,j as e,f as $,s as B,g as M,h as E,c as R,e as O,k as q}from"./index-BhGRH4j_.js";import{u as z,C as N}from"./index.esm-BaFYeH-U.js";import{C as J,a as H,b as V,c as W}from"./card-D37_4B0e.js";import{L as S,I as P,T as K}from"./textarea-CG0L2Xgl.js";import{B as Q}from"./button-BKg7fv5Z.js";import{D as X,k as p}from"./index-CPkugmyn.js";import{A as Y}from"./AreaGovernmentSelector-DRUTGV-z.js";import{G as A}from"./data-CCad6NMS.js";import{U as Z}from"./UserDetailsBalance-BQBrPT4s.js";import{G as ee}from"./iconBase-Cko8keTZ.js";import"./index-B5pA4OD8.js";import"./index-C_J-X2VZ.js";import"./data-R_Et5bCc.js";import"./index-BOjCBvv_.js";import"./index-BkhPpbPR.js";import"./index-uvlURWTs.js";import"./index-DKMuPG4E.js";const se=({selectedUserUid:n,usersData:f})=>{const{updateUser:F}=T(),[w,i]=l.useState({}),[D,j]=l.useState({}),[b,g]=l.useState(""),{control:d,handleSubmit:x,setValue:o}=z(),[y,k]=l.useState({}),[C,v]=l.useState(0),[m,U]=l.useState([]);l.useEffect(()=>{var t,s;const a=f.find(r=>r._id===n);console.log(a),a&&(i(a),j({area:((t=a.address)==null?void 0:t.area)||"",governments:((s=a.address)==null?void 0:s.govern)||[]}),U(a.social||[]),o("name",a.name),o("phone",a.phone),o("bio",a.bio),o("email",a.email),g(a.profileImage||""),console.log(a.profileImage||""))},[n,f,o]);const _=(a,t)=>{const s=[...m];s[a].link=t,U(s)},h=async a=>{const t={...a,selectedAddress:y,profileImage:b,verified:!1,socialLinks:m};try{const s=await R.put(`/user/update_user/${n}`,t);await F(s.data.data),p.success("تم حفظ التعديلات بنجاح"),console.log(s.data)}catch(s){console.error("خطأ في تحديث البيانات:",s),p.error("فشل في تحديث البيانات")}},I=({selectedArea:a,selectedGovernments:t})=>{k(s=>s.area===a&&JSON.stringify(s.govern)===JSON.stringify(t)?s:{area:a,govern:t})},L=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){p.error("يرجى رفع ملف صورة فقط.");return}if(t.size>2*1024*1024){p.error("حجم الصورة كبير جدًا. الحد الأقصى هو 2 ميغابايت.");return}v(0);const s=w.email||"noUser",r=$(B,`${s}/profile/${t.name}`),u=M(r,t);u.on("state_changed",c=>{const G=c.bytesTransferred/c.totalBytes*100;v(G)},c=>{p.error("خطأ أثناء رفع الصورة."),console.error("خطأ أثناء رفع الصورة:",c)},async()=>{try{const c=await E(u.snapshot.ref);g(c),v(0),p.success("تم رفع الصورة بنجاح.")}catch(c){console.error("خطأ في الحصول على رابط التنزيل:",c)}})};return e.jsxs(J,{children:[e.jsx(H,{children:e.jsx(V,{className:"text-3xl font-bold text-indigo-900 mt-10",children:"إعدادات الحساب"})}),e.jsxs(W,{children:[e.jsx("p",{className:"mb-6 text-gray-600",children:"يمكنك هنا تحديث بيانات حسابك بما في ذلك التفاصيل الشخصية وصورتك الشخصية."}),e.jsxs("form",{onSubmit:x(h),className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx(N,{name:"profilePicture",control:d,render:({field:a})=>e.jsx("img",{className:"object-cover w-32 h-32 rounded-full ring-4 ring-indigo-300 mb-4",src:b||w.profileImage||"https://via.placeholder.com/150",alt:"Profile"})}),e.jsxs(S,{htmlFor:"profilePicture",className:"cursor-pointer",children:[e.jsx("span",{className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300",children:"تغيير الصورة الشخصية"}),e.jsx(P,{id:"profilePicture",type:"file",accept:"image/*",onChange:L,className:"hidden"}),C!==0&&e.jsx("div",{className:"relative w-full mt-4 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${C}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"name",children:"اسم الشهرة او الحساب*"}),e.jsx(N,{name:"name",control:d,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"email",children:"البريد الإلكتروني* "}),e.jsx(N,{name:"email",control:d,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"phone",children:"رقم الهاتف*"}),e.jsx(N,{name:"phone",control:d,rules:{required:"رقم الهاتف مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("label",{htmlFor:"",children:"التواصل الاجتماعي"}),m.map((a,t)=>(a.link||a.label)&&e.jsx("div",{className:"space-y- col-span-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 text-gray-800 flex items-center justify-between",children:e.jsx("input",{type:"url",value:a.link||"",onChange:s=>_(t,s.target.value),className:"w-full bg-gray-100 border-none focus:ring-0",placeholder:`أدخل الرابط لـ ${a.label||"التواصل الاجتماعي"}`})})},t)),e.jsx("button",{type:"button",onClick:()=>U([...m,{label:"",link:" "}]),className:"col-span-3 mt-4 max-h-10 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"إضافة رابط جديد"})]}),e.jsx(Y,{initialData:D,onSelectionChange:I}),e.jsxs("div",{className:"space-y-2 col-span- h-full",children:[e.jsx(S,{htmlFor:"bio",children:"نبذة عنك"}),e.jsx(N,{name:"bio",control:d,render:({field:a})=>e.jsx(K,{...a,rows:4})})]})]}),e.jsx(Q,{type:"submit",className:"w-full text-white",children:"حفظ التغييرات"})]})]}),e.jsx(X,{position:"top-center",reverseOrder:!1})]})};function ae(n){return ee({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"},child:[]}]})(n)}const ye=()=>{var t;const[n,f]=l.useState([]),{allUsers:F,updateUser:w}=O(),[i,D]=l.useState("all"),[j,b]=l.useState("all"),{id:g}=q();console.log("useParams output:",g),l.useEffect(()=>{if(g&&n.length>0){const s=n.find(r=>r._id===g);s&&I(s._id)}},[g,n]);const d=n.filter(s=>{var c;const r=i==="all"||s.govern===i,u=j==="all"||((c=s.area)==null?void 0:c.includes(j));return r&&u}),[x,o]=l.useState(1),y=20,k=x*y,C=k-y,v=d.slice(C,k),m=Math.ceil(d.length/y),[U,_]=l.useState("");l.useEffect(()=>{(async()=>{try{const r=await R.get("/user/all_users");console.log(r.data.data),f(r.data.data)}catch(r){console.log(r)}})()},[F]);const[h,I]=l.useState(null),L=s=>{f(r=>r.map(u=>u._id===s._id?s:u)),w(s)},a=s=>{switch(s){case"none":return"text-white";case"silver":return"text-gray-300";case"gold":return"text-yellow-500";case"bronze":return"text-yellow-200";default:return""}};return e.jsxs("div",{className:"grow md:p-8 p-2  dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"النجوم"}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 w-full max-w-screen overflow-x-auto",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("select",{value:i,onChange:s=>{D(s.target.value),o(1),b("all")},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"كل المناطق"}),A.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:j,onChange:s=>{b(s.target.value),o(1)},className:"border rounded px-2 py-1",disabled:i==="all",children:[e.jsx("option",{value:"all",children:"كل المحافظات"}),i!=="all"&&((t=A.find(s=>s.name===i))==null?void 0:t.subGovernments.map(s=>e.jsx("option",{value:s,children:s},s)))]})]})}),e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات النجوم"}),e.jsxs("table",{className:"table-auto w-full  text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-4 text-right min-w-36 ",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right",children:"فئة النجم"})]})}),e.jsx("tbody",{children:v.map((s,r)=>s.role==="star"&&e.jsxs("tr",{onClick:()=>I(s._id),className:`border-b hover:bg-gray-100 dark:hover:bg-gray-700 ${s._id===h?"bg-gray-200 dark:bg-gray-600":""}`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 flex items-center gap-2",children:s.accountType!=="غير مقبول"&&e.jsx(ae,{className:a(s.accountType)})})]},r))})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>o(s=>Math.max(s-1,1)),disabled:x===1,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"السابق"}),Array.from({length:m},(s,r)=>e.jsx("button",{onClick:()=>o(r+1),className:`px-4 py-2 mx-1 rounded-lg ${x===r+1?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:r+1},r)),e.jsx("button",{onClick:()=>o(s=>Math.min(s+1,m)),disabled:x===m,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"التالي"})]})]}),h&&e.jsx(se,{selectedUserUid:h,usersData:n,onSave:L}),h&&e.jsx(Z,{selectedUserUid:h,usersData:n,onSave:L})]})};export{ye as default};
