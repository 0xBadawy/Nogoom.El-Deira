import{u as z,e as V,b as _,r as l,j as e,f as W,s as X,g as Y,h as H,c as K}from"./index-BhGRH4j_.js";import{u as Q}from"./index.esm-BaFYeH-U.js";import{D as Z,k as o}from"./index-CPkugmyn.js";import{A as ee}from"./AreaGovernmentSelector-DRUTGV-z.js";import{U as se}from"./UserSelector2-C06BoLtA.js";import{X as D}from"./x-owJV0okw.js";import"./data-R_Et5bCc.js";const ge=()=>{const U=z(),{addADs:re}=V(),{getUserEmail:ae}=_(),[n,C]=l.useState({images:0,video:0}),[u,x]=l.useState(!1),[i,b]=l.useState({images:[],video:""}),[h,f]=l.useState([]),[v,P]=l.useState([]),[p,$]=l.useState({area:"",govern:[]}),[j,N]=l.useState(null),{register:g,handleSubmit:A,reset:L,formState:{errors:m}}=Q(),R=l.useCallback(({selectedArea:s,selectedGovernments:r})=>{$(a=>a.area!==s||JSON.stringify(a.govern)!==JSON.stringify(r)?{area:s,govern:r}:a)},[]),F=(s,r)=>new Date(s)<=new Date(r),M=s=>{b(r=>({...r,images:r.images.filter((a,t)=>t!==s)}))},q=()=>{b(s=>({...s,video:""})),N(null)},k=async(s,r)=>{if(!s.length)return;x(!0);const a=r==="images"?["image/jpeg","image/png","image/gif","image/webp"]:["video/mp4","video/webm"],t=Array.from(s).find(d=>!a.includes(d.type));if(t){o.error(`نوع الملف غير مدعوم: ${t.name}`),x(!1);return}if(r==="video"&&s[0]){const d=URL.createObjectURL(s[0]);N(d)}const E=Array.from(s).map(d=>{const G=W(X,`noUser/${r}/${d.name}`),w=Y(G,d);return new Promise((J,S)=>{w.on("state_changed",c=>{const O=c.bytesTransferred/c.totalBytes*100;C(T=>({...T,[r]:O}))},S,async()=>{try{const c=await H(w.snapshot.ref);J(c)}catch(c){S(c)}})})});try{const d=await Promise.all(E);b(y=>({...y,[r]:r==="images"?[...y.images,...d]:d[0]}))}catch(d){o.error(`خطأ في رفع الملفات: ${d.message}`)}finally{x(!1)}},B=(s,r)=>{f(a=>{const t=[...a];return t[s]={...t[s],link:r},t})},I=async s=>{if(!F(s.startDate,s.endDate)){o.error("تاريخ البداية يجب أن يكون قبل تاريخ النهاية");return}if(v.length===0){o.error("يجب اختيار نجم واحد على الأقل");return}if(p.area===""||p.govern.length===0){o.error("يجب اختيار منطقة واحدة على الأقل");return}const r={...s,address:p,Images:i.images.length?i.images:["https://firebasestorage.googleapis.com/v0/b/default-placeholder-image.jpg"],videos:i.video,views:0,links:h.filter(a=>{var t;return(t=a.link)==null?void 0:t.trim()}),users:v};console.log("Ad Data:",r);try{const a=await K.post("/advertisement/add",r);console.log(a.data),o.success("تم إضافة الحملة بنجاح"),L(),U("/dashboard/ads-list")}catch(a){o.error(`خطأ في إضافة الحملة: ${a.message}`)}};return e.jsxs("div",{className:"p-4 md:p-8 bg-gray-50 dark:bg-gray-800 min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-6",children:"إضافة حملة جديدة"}),e.jsxs("form",{onSubmit:A(I),className:"bg-white dark:bg-gray-700 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"عنوان الحملة"}),e.jsx("input",{...g("title",{required:"عنوان الحملة مطلوب"}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600"}),m.title&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"شرح الحملة"}),e.jsx("textarea",{...g("description",{required:"وصف الحملة مطلوب"}),rows:4,className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600"}),m.description&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"تاريخ البداية"}),e.jsx("input",{type:"date",...g("startDate",{required:"تاريخ البداية مطلوب"}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"تاريخ النهاية"}),e.jsx("input",{type:"date",...g("endDate",{required:"تاريخ النهاية مطلوب"}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"صور الحملة"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:s=>k(s.target.files,"images"),className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"اختر الصور"}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG, GIF حتى 10MB"})]})}),i.images.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:i.images.map((s,r)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s,alt:`Preview ${r+1}`,className:"w-full h-32 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>M(r),className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(D,{size:16})})]},r))}),n.images>0&&n.images<100&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${n.images}%`}})})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2",children:"فيديو الحملة"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx("input",{type:"file",accept:"video/*",onChange:s=>k(s.target.files,"video"),className:"hidden",id:"video-upload"}),e.jsx("label",{htmlFor:"video-upload",className:"cursor-pointer bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:"اختر الفيديو"}),e.jsx("p",{className:"text-xs text-gray-500",children:"MP4, WebM حتى 100MB"})]})}),(j||i.video)&&e.jsxs("div",{className:"mt-4 relative group",children:[e.jsx("video",{controls:!0,className:"w-full max-h-64 rounded-lg",src:j||i.video,children:"Your browser does not support the video tag."}),e.jsx("button",{type:"button",onClick:q,className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(D,{size:16})})]}),n.video>0&&n.video<100&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${n.video}%`}})})})]})]})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(ee,{onSelectionChange:R})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-4",children:"روابط التواصل الاجتماعي"}),h.map((s,r)=>e.jsx("div",{className:"mb-2",children:e.jsx("input",{type:"url",value:s.link||"",onChange:a=>B(r,a.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600",placeholder:"أدخل رابط التواصل الاجتماعي"})},r)),e.jsx("button",{type:"button",onClick:()=>f([...h,{link:""}]),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"إضافة رابط جديد"})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(se,{initialSelectedUsers:[],onSelectionChange:P})}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{type:"submit",disabled:u,className:`w-full py-3 px-4 rounded-lg text-white font-medium ${u?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:u?"جاري الإضافة...":"إضافة الحملة"})})]})]}),e.jsx(Z,{position:"top-center"})]})};export{ge as default};
