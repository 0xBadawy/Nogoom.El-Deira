import{d as q,r as d,j as e,e as c,a as D,f as L}from"./index-DtqOgNe1.js";import{u as M}from"./index.esm-BU8hUtji.js";import"./index-CaL-DFCE.js";import{D as F,a as O,b as I,c as R,d as B}from"./dialog-DocjR-x_.js";import{B as _}from"./button-DtkeHxfg.js";import{D as T,k as V}from"./index-D1NgUxjE.js";import"./index-CKVIYkqc.js";import"./index-DnzlpQjw.js";import"./index-Br9BNLE8.js";import"./index-BklVsXj5.js";import"./x-DdO8dQU5.js";const H=()=>{const{register:r,handleSubmit:h,watch:l,reset:x,formState:{errors:a}}=M(),{signUp:m}=q(),[n,o]=d.useState(null),[p,b]=d.useState(!1);l("password");const[g,w]=d.useState(!1),N=()=>{w(!g)},y=async t=>{if(!/^[a-zA-Z0-9]{3,15}$/.test(t.username)){c.error("يجب أن يكون اسم الموظف مكوناً من 3 إلى 15 حرفاً ويمكن أن يحتوي على حروف وأرقام فقط");return}if(t.password!==t["confirm-password"]){c.error("كلمتا المرور غير متطابقتين");return}if(confirm("هل انت متأكد من إضافة هذا الموظف")==!0)try{await v(t),c.success("تم إضافة الموظف بنجاح!"),x(),window.location.reload()}catch{c.error("حدث خطأ أثناء إضافة الموظف.")}else c.error("تم إلغاء العملية")},v=async t=>{o(null),console.log("Form Data:",t);try{b(!0);const i=await D.post("/user/add_user",t);if(console.log("Response:",i),i.data.status==="error"){c.error(i.data.message),o(i.data.message);return}c.success("تم إضافة الموظف بنجاح!")}catch(i){console.log("Error:",i),i.response.data.message==="Email already exists"?(c.error("الموظف موجود بالفعل"),o("الموظف موجود بالفعل")):(o("حدث خطأ أثناء إضافة الموظف."),c.error("حدث خطأ أثناء إضافة الموظف."))}b(!1)};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:"إضافة موظف"}),n&&e.jsx("p",{className:"text-red-500 text-center mt-2 bg-red-100 p-2 rounded-lg font-semibold",children:n}),e.jsxs("form",{onSubmit:h(y),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...r("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...r("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),a.email&&e.jsx("p",{className:"text-red-500 text-sm",children:a.email.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-1",children:[" ","رقم الهاتف"]}),e.jsx("input",{type:"number",...r("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),a.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:a.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",...r("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),e.jsx("button",{type:"button",onClick:N,className:"absolute left-2 top-2 text-gray-500",children:g?"إخفاء":"إظهار"})]}),a.password&&e.jsx("p",{className:"text-red-500 text-sm",children:a.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",...r("confirm-password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),e.jsx("button",{type:"button",onClick:N,className:"absolute left-2 top-2 text-gray-500",children:g?"إخفاء":"إظهار"})]}),a.password&&e.jsx("p",{className:"text-red-500 text-sm",children:a.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...r("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsxs("option",{value:"admin",children:[e.jsx("span",{children:"مدير"})," (كل الصلاحيات)"]}),e.jsxs("option",{value:"editor",children:[e.jsx("span",{children:"محرر"}),"(كل الصلاحيات عدا الموظفين والمحفظة)"]}),e.jsxs("option",{value:"viewer",children:[" ",e.jsx("span",{children:"مشاهد"})," (الدخول والمتابعة فقط)"]})]}),a.role&&e.jsx("p",{className:"text-red-500 text-sm",children:a.role.message})]}),e.jsx("div",{className:"flex flex-row",children:e.jsx("button",{type:"submit",disabled:p,className:"w-fit px-20 mx-auto bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-200",children:p?"جارٍ الحفظ...":"حفظ البيانات"})}),n&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:n})]})]})},z=({children:r})=>e.jsx("span",{style:{position:"absolute",width:"1px",height:"1px",background:"white",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0},children:r}),Z=({title:r="تأكيد العملية",message:h="هل أنت متأكد من الاستمرار؟",isOpen:l,onClose:x,onConfirm:a,onCancel:m})=>e.jsx("div",{className:"bg-white",children:e.jsx(F,{open:l,onOpenChange:x,children:e.jsxs(O,{className:"bg-white",children:[e.jsxs(I,{children:[e.jsx(z,{children:e.jsx(R,{children:r})}),e.jsx("p",{children:h})]}),e.jsxs(B,{children:[e.jsx(_,{variant:"ghost",onClick:m,children:"إلغاء"}),e.jsx(_,{className:"text-white",onClick:a,children:"نعم"})]})]})})}),G=({userData:r,onUserUpdated:h})=>{const{register:l,handleSubmit:x,setValue:a,reset:m,formState:{errors:n}}=M(),{signUp:o,updateUser:p}=q(),[b,g]=d.useState(null),[w,N]=d.useState(!1);d.useEffect(()=>{r?Object.keys(r).forEach(t=>{a(t,r[t])}):m()},[r,a,m]);const y=async t=>{const i=!!r;if(confirm(i?"هل أنت متأكد من تحديث بيانات المستخدم؟":"هل انت متأكد من إضافة هذا المستخدم؟"))try{await v(t,i),alert("تمت العملية بنجاح!"),window.location.reload(),window.location.reload()}catch(S){console.error("حدث خطأ أثناء العملية:",S),alert("حدث خطأ أثناء العملية.")}else V.error("تم إلغاء العملية")},v=async(t,i)=>{const u=await D.put(`/user/update_user/${r._id}`,t);if(console.log("Response:",u),u.data.status==="error")throw new Error(u.data.message);h(u.data.data)};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:r?"تحديث بيانات الموظف":"إضافة موظف"}),e.jsxs("form",{onSubmit:x(y),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...l("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),n.name&&e.jsx("p",{className:"text-red-500 text-sm",children:n.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...l("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),n.email&&e.jsx("p",{className:"text-red-500 text-sm",children:n.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"text",...l("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),n.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:n.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...l("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsx("option",{value:"admin",children:"مدير"}),e.jsx("option",{value:"editor",children:"محرر"}),e.jsx("option",{value:"manager",children:"مشاهد"})]}),n.role&&e.jsx("p",{className:"text-red-500 text-sm",children:n.role.message})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:w?"جارٍ الحفظ...":r?"تحديث البيانات":"حفظ البيانات"}),b&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:b})]}),e.jsx(T,{position:"top-center",reverseOrder:!1})]})},$=({lastSeenDate:r})=>{const[h,l]=d.useState("");return d.useEffect(()=>{const x=()=>{const m=new Date,n=new Date(r),o=Math.floor((m-n)/1e3);if(o<120)l("🟢 نشط الآن ");else if(o<60)l(`منذ ${o} ثانية`);else if(o<3600){const p=Math.floor(o/60);l(`منذ ${p} دقيقة`)}else if(o<86400){const p=Math.floor(o/3600);l(`منذ ${p} ساعة`)}else{const p=Math.floor(o/86400);l(`منذ ${p} يوم`)}};x();const a=setInterval(x,6e4);return()=>clearInterval(a)},[r]),e.jsx("span",{children:h})},le=()=>{const[r,h]=d.useState([]),[l,x]=d.useState(null),[a,m]=d.useState(!1),[n,o]=d.useState(!1),{deleteUserFromDB:p}=L();d.useEffect(()=>{(async()=>{try{const j=(await D.get("/user/all_users_admin")).data.data.sort((C,P)=>new Date(P.lastSeen)-new Date(C.lastSeen));console.log("Sorted Users:",j),h(j)}catch{c.error("فشل في تحميل البيانات")}})()},[]);const b=s=>{x(s)},g=()=>{m(!0)},w=()=>{(async()=>{try{const f=await D.delete("/user/delete_user",{params:{id:l}});if(console.log("Response:",f),f.data.status==="error"){c.error(f.data.message);return}c.success("تم حذف الموظف بنجاح"),h(j=>j.filter(C=>C._id!==l)),x(null),m(!1)}catch{c.error("حدث خطأ أثناء حذف الموظف.")}})(),m(!1)},N=()=>{m(!1),c.error("تم إلغاء العملية",{description:new Date().toLocaleString()})},y=()=>{o(!0)},v=()=>{o(!1),x(null)},t=r.find(s=>s._id===l),i=s=>{var j;return s?(((j=s.toDate)==null?void 0:j.call(s))||new Date(s)).toLocaleString():"غير متاح"},[u,U]=d.useState(1),S=5,E=r==null?void 0:r.filter(s=>s.role!=="star"&&!s.isDeleted),k=Math.ceil(E.length/S),A=E.slice((u-1)*S,u*S);return e.jsxs("div",{className:"grow md:p-8 p-2 dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"الموظفين"}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 w-full max-w-screen overflow-x-auto",children:[e.jsx(H,{}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"قائمة المستخدمين"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"py-2 px-4 text-right",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right hi dden md:table-cell",children:"اخر ظهور"})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{onClick:()=>b(s._id),className:`border-b cursor-pointer ${s._id===l?"bg-gray-200":""} hover:bg-gray-100`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 hidd en text-sm md:table-cell",children:e.jsx($,{lastSeenDate:s.lastSeen})})]},s._id))})]})}),e.jsxs("div",{className:"flex justify-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>U(s=>Math.max(s-1,1)),disabled:u===1,className:`px-4 py-2 rounded ${u===1?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"}`,children:"السابق"}),e.jsxs("span",{className:"px-4 py-2",children:[u," من ",k]}),e.jsx("button",{onClick:()=>U(s=>Math.min(s+1,k)),disabled:u===k,className:`px-4 py-2 rounded ${u===k?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"}`,children:"التالي"})]})]}),t&&e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات المستخدم"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"md:w-1/2",children:["name","email","role","phone"].map(s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:s==="role"?"الوظيفة":s==="phone"?"رقم الهاتف":s==="username"?"اسم المستخدم":s==="email"?"البريد الإلكتروني":"الاسم"}),e.jsx("span",{children:s==="role"?t[s]==="admin"?"مدير":t[s]==="editor"?"محرر":"مشاهد":t[s]})]},s))}),e.jsxs("div",{className:"md:w-1/2",children:[["lastSeen","createdAt"].map(s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:s==="lastSeen"?"تاريخ أخر ظهور":"تاريخ انشاء الحساب"}),e.jsx("span",{children:i(t[s])})]},s)),e.jsxs("div",{className:"flex items-center mb-4 ",children:[e.jsx("p",{className:"w-32",children:" اخر ظهور :"}),e.jsx($,{lastSeenDate:t.lastSeen})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded-lg",onClick:g,children:"حذف المستخدم"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg",onClick:y,children:"تعديل المستخدم"})]})]}),e.jsx(Z,{title:"تأكيد الحذف",message:"هل متأكد من حذف هذا المستخدم؟",isOpen:a,onClose:()=>m(!1),onConfirm:w,onCancel:N})]}),n&&e.jsx(G,{userData:t,onUserUpdated:v})]})};export{le as default};
