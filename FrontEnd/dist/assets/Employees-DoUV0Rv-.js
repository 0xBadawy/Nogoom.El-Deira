import{c as $,r as d,j as e,e as c,d as D,f as P}from"./index-CBmwFr6s.js";import{u as q}from"./index.esm-DdHNebxU.js";import"./index-EILlbki9.js";import{D as L,a as F,b as O,c as I,d as R}from"./dialog-CTbXbg2t.js";import{B as _}from"./button-D0DK3SXd.js";import{D as B,k as T}from"./index-CUVxPTK7.js";import"./index-CvFL-R44.js";import"./index-B_3blrWR.js";import"./index-BVOvNNqV.js";import"./index-ClfcRRQ0.js";import"./x-DDXRnAHS.js";const V=()=>{const{register:r,handleSubmit:h,watch:l,reset:x,formState:{errors:t}}=q(),{signUp:m}=$(),[o,n]=d.useState(null),[p,b]=d.useState(!1);l("password");const[g,w]=d.useState(!1),y=()=>{w(!g)},N=async a=>{if(!/^[a-zA-Z0-9]{3,15}$/.test(a.username)){c.error("يجب أن يكون اسم الموظف مكوناً من 3 إلى 15 حرفاً ويمكن أن يحتوي على حروف وأرقام فقط");return}if(a.password!==a["confirm-password"]){c.error("كلمتا المرور غير متطابقتين");return}if(confirm("هل انت متأكد من إضافة هذا الموظف")==!0)try{await v(a),c.success("تم إضافة الموظف بنجاح!"),x(),window.location.reload()}catch{c.error("حدث خطأ أثناء إضافة الموظف.")}else c.error("تم إلغاء العملية")},v=async a=>{n(null),console.log("Form Data:",a);try{b(!0);const i=await D.post("/user/add_user",a);if(console.log("Response:",i),i.data.status==="error"){c.error(i.data.message),n(i.data.message);return}c.success("تم إضافة الموظف بنجاح!")}catch(i){console.log("Error:",i),i.response.data.message==="Email already exists"?(c.error("الموظف موجود بالفعل"),n("الموظف موجود بالفعل")):(n("حدث خطأ أثناء إضافة الموظف."),c.error("حدث خطأ أثناء إضافة الموظف."))}b(!1)};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:"إضافة موظف"}),o&&e.jsx("p",{className:"text-red-500 text-center mt-2 bg-red-100 p-2 rounded-lg font-semibold",children:o}),e.jsxs("form",{onSubmit:h(N),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...r("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),t.name&&e.jsx("p",{className:"text-red-500 text-sm",children:t.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...r("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),t.email&&e.jsx("p",{className:"text-red-500 text-sm",children:t.email.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 font-medium mb-1",children:[" ","رقم الهاتف"]}),e.jsx("input",{type:"number",...r("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),t.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:t.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",...r("password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),e.jsx("button",{type:"button",onClick:y,className:"absolute left-2 top-2 text-gray-500",children:g?"إخفاء":"إظهار"})]}),t.password&&e.jsx("p",{className:"text-red-500 text-sm",children:t.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:g?"text":"password",...r("confirm-password",{required:"كلمة المرور مطلوبة",minLength:{value:8,message:"كلمة المرور يجب أن تكون 8 أحرف على الأقل"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل كلمة المرور"}),e.jsx("button",{type:"button",onClick:y,className:"absolute left-2 top-2 text-gray-500",children:g?"إخفاء":"إظهار"})]}),t.password&&e.jsx("p",{className:"text-red-500 text-sm",children:t.password.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...r("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsxs("option",{value:"admin",children:[e.jsx("span",{children:"مدير"})," (كل الصلاحيات)"]}),e.jsxs("option",{value:"editor",children:[e.jsx("span",{children:"محرر"}),"(كل الصلاحيات عدا الموظفين والمحفظة)"]}),e.jsxs("option",{value:"viewer",children:[" ",e.jsx("span",{children:"مشاهد"})," (الدخول والمتابعة فقط)"]})]}),t.role&&e.jsx("p",{className:"text-red-500 text-sm",children:t.role.message})]}),e.jsx("div",{className:"flex flex-row",children:e.jsx("button",{type:"submit",disabled:p,className:"w-fit px-20 mx-auto bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition duration-200",children:p?"جارٍ الحفظ...":"حفظ البيانات"})}),o&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:o})]})]})},H=({children:r})=>e.jsx("span",{style:{position:"absolute",width:"1px",height:"1px",background:"white",padding:0,margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:0},children:r}),z=({title:r="تأكيد العملية",message:h="هل أنت متأكد من الاستمرار؟",isOpen:l,onClose:x,onConfirm:t,onCancel:m})=>e.jsx("div",{className:"bg-white",children:e.jsx(L,{open:l,onOpenChange:x,children:e.jsxs(F,{className:"bg-white",children:[e.jsxs(O,{children:[e.jsx(H,{children:e.jsx(I,{children:r})}),e.jsx("p",{children:h})]}),e.jsxs(R,{children:[e.jsx(_,{variant:"ghost",onClick:m,children:"إلغاء"}),e.jsx(_,{className:"text-white",onClick:t,children:"نعم"})]})]})})}),Z=({userData:r,onUserUpdated:h})=>{const{register:l,handleSubmit:x,setValue:t,reset:m,formState:{errors:o}}=q(),{signUp:n,updateUser:p}=$(),[b,g]=d.useState(null),[w,y]=d.useState(!1);d.useEffect(()=>{r?Object.keys(r).forEach(a=>{t(a,r[a])}):m()},[r,t,m]);const N=async a=>{const i=!!r;if(confirm(i?"هل أنت متأكد من تحديث بيانات المستخدم؟":"هل انت متأكد من إضافة هذا المستخدم؟"))try{await v(a,i),alert("تمت العملية بنجاح!"),window.location.reload(),window.location.reload()}catch(S){console.error("حدث خطأ أثناء العملية:",S),alert("حدث خطأ أثناء العملية.")}else T.error("تم إلغاء العملية")},v=async(a,i)=>{const u=await D.put(`/user/update_user/${r._id}`,a);if(console.log("Response:",u),u.data.status==="error")throw new Error(u.data.message);h(u.data.data)};return e.jsxs("div",{className:"mx-auto mt-10 md:p-6 p-2 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-center mb-4",children:r?"تحديث بيانات الموظف":"إضافة موظف"}),e.jsxs("form",{onSubmit:x(N),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الاسم"}),e.jsx("input",{type:"text",...l("name",{required:"الاسم مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل الاسم"}),o.name&&e.jsx("p",{className:"text-red-500 text-sm",children:o.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",...l("email",{required:"البريد الإلكتروني مطلوب",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"أدخل بريد إلكتروني صالح"}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل البريد الإلكتروني"}),o.email&&e.jsx("p",{className:"text-red-500 text-sm",children:o.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"رقم الهاتف"}),e.jsx("input",{type:"text",...l("phone",{required:"رقم الهاتف مطلوب"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"أدخل رقم الهاتف"}),o.phone&&e.jsx("p",{className:"text-red-500 text-sm",children:o.phone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"الصلاحيات"}),e.jsxs("select",{...l("role",{required:"الصلاحيات مطلوبة"}),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"اختر الصلاحيات"}),e.jsx("option",{value:"admin",children:"مدير"}),e.jsx("option",{value:"editor",children:"محرر"}),e.jsx("option",{value:"manager",children:"مشاهد"})]}),o.role&&e.jsx("p",{className:"text-red-500 text-sm",children:o.role.message})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200",children:w?"جارٍ الحفظ...":r?"تحديث البيانات":"حفظ البيانات"}),b&&e.jsx("p",{className:"text-red-500 text-center mt-2",children:b})]}),e.jsx(B,{position:"top-center",reverseOrder:!1})]})},G=({lastSeenDate:r})=>{const[h,l]=d.useState("");return d.useEffect(()=>{const x=()=>{const m=new Date,o=new Date(r),n=Math.floor((m-o)/1e3);if(n<60)l(`منذ ${n} ثانية`);else if(n<3600){const p=Math.floor(n/60);l(`منذ ${p} دقيقة`)}else if(n<86400){const p=Math.floor(n/3600);l(`منذ ${p} ساعة`)}else{const p=Math.floor(n/86400);l(`منذ ${p} يوم`)}};x();const t=setInterval(x,6e4);return()=>clearInterval(t)},[r]),e.jsx("span",{children:h})},le=()=>{const[r,h]=d.useState([]),[l,x]=d.useState(null),[t,m]=d.useState(!1),[o,n]=d.useState(!1),{deleteUserFromDB:p}=P();d.useEffect(()=>{(async()=>{try{const j=(await D.get("/user/all_users_admin")).data.data.sort((C,A)=>new Date(A.lastSeen)-new Date(C.lastSeen));console.log("Sorted Users:",j),h(j)}catch{c.error("فشل في تحميل البيانات")}})()},[]);const b=s=>{x(s)},g=()=>{m(!0)},w=()=>{(async()=>{try{const f=await D.delete("/user/delete_user",{params:{id:l}});if(console.log("Response:",f),f.data.status==="error"){c.error(f.data.message);return}c.success("تم حذف الموظف بنجاح"),h(j=>j.filter(C=>C._id!==l)),x(null),m(!1)}catch{c.error("حدث خطأ أثناء حذف الموظف.")}})(),m(!1)},y=()=>{m(!1),c.error("تم إلغاء العملية",{description:new Date().toLocaleString()})},N=()=>{n(!0)},v=()=>{n(!1),x(null)},a=r.find(s=>s._id===l),i=s=>{var j;return s?(((j=s.toDate)==null?void 0:j.call(s))||new Date(s)).toLocaleString():"غير متاح"},[u,U]=d.useState(1),S=5,E=r==null?void 0:r.filter(s=>s.role!=="star"&&!s.isDeleted),k=Math.ceil(E.length/S),M=E.slice((u-1)*S,u*S);return e.jsxs("div",{className:"grow md:p-8 p-2 dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"الموظفين"}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 w-full max-w-screen overflow-x-auto",children:[e.jsx(V,{}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"قائمة المستخدمين"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"py-2 px-4 text-right",children:"الاسم"}),e.jsx("th",{className:"py-2 px-4 text-right hidden md:table-cell",children:"اخر ظهور"})]})}),e.jsx("tbody",{children:M.map(s=>e.jsxs("tr",{onClick:()=>b(s._id),className:`border-b cursor-pointer ${s._id===l?"bg-gray-200":""} hover:bg-gray-100`,children:[e.jsx("td",{className:"py-2 px-4",children:s.name}),e.jsx("td",{className:"py-2 px-4 hidden md:table-cell",children:e.jsx(G,{lastSeenDate:s.lastSeen})})]},s._id))})]})}),e.jsxs("div",{className:"flex justify-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>U(s=>Math.max(s-1,1)),disabled:u===1,className:`px-4 py-2 rounded ${u===1?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"}`,children:"السابق"}),e.jsxs("span",{className:"px-4 py-2",children:[u," من ",k]}),e.jsx("button",{onClick:()=>U(s=>Math.min(s+1,k)),disabled:u===k,className:`px-4 py-2 rounded ${u===k?"bg-gray-300 cursor-not-allowed":"bg-blue-500 text-white"}`,children:"التالي"})]})]}),a&&e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات المستخدم"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"md:w-1/2",children:["name","email","role","phone"].map(s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:s==="role"?"الوظيفة":s==="phone"?"رقم الهاتف":s==="username"?"اسم المستخدم":s==="email"?"البريد الإلكتروني":"الاسم"}),e.jsx("span",{children:s==="role"?a[s]==="admin"?"مدير":a[s]==="editor"?"محرر":"مشاهد":a[s]})]},s))}),e.jsx("div",{className:"md:w-1/2",children:["lastSeen","createdAt"].map(s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("span",{className:"w-32",children:s==="lastSeen"?"تاريخ أخر ظهور":"تاريخ انشاء الحساب"}),e.jsx("span",{children:i(a[s])})]},s))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"bg-red-500 text-white px-4 py-2 rounded-lg",onClick:g,children:"حذف المستخدم"}),e.jsx("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg",onClick:N,children:"تعديل المستخدم"})]})]}),e.jsx(z,{title:"تأكيد الحذف",message:"هل متأكد من حذف هذا المستخدم؟",isOpen:t,onClose:()=>m(!1),onConfirm:w,onCancel:y})]}),o&&e.jsx(Z,{userData:a,onUserUpdated:v})]})};export{le as default};
