import{d as R,r as l,j as e,g as E,s as G,h as M,i as O,a as $,f as T,l as q}from"./index-BLZ4aqdM.js";import{u as z,C as I}from"./index.esm-DL-DIQfq.js";import{C as J,a as W,b as H,c as V}from"./card-BpfrEXWV.js";import{L as D,I as F}from"./textarea-CfPrhxpN.js";import{B as K}from"./button-CdQumLxo.js";import{D as Q,k as f}from"./index-wjiC_Ptq.js";import{A as X}from"./AreaGovernmentSelector-CD9F4H2p.js";import{G as A}from"./data-Csv9xAeZ.js";import{U as Y}from"./UserDetailsBalance-v9uBH_gZ.js";import"./index-D7bPvczS.js";import"./index-BgyVLihh.js";import"./data-DhDULqLU.js";import"./index-BYDlMPGG.js";import"./index-C96Y5j6w.js";import"./index-CSRYiD8I.js";import"./index-OwdsdsWL.js";const Z=({selectedUserUid:n,usersData:c})=>{const{updateUser:j}=R(),[u,d]=l.useState({}),[L,b]=l.useState({}),[y,v]=l.useState(""),{control:m,handleSubmit:w,setValue:i}=z(),[g,N]=l.useState({}),[S,k]=l.useState(0),[C,p]=l.useState([]);l.useEffect(()=>{var t,s;const a=c.find(r=>r._id===n);console.log(a),a&&(d(a),b({area:((t=a.address)==null?void 0:t.area)||"",governments:((s=a.address)==null?void 0:s.govern)||[]}),p(a.social||[]),i("name",a.name),i("phone",a.phone),i("bio",a.bio),i("email",a.email),v(a.profileImage||""),console.log(a.profileImage||""))},[n,c,i]);const P=(a,t)=>{const s=[...C];s[a].link=t,p(s)},_=async a=>{const t={...a,address:g,profileImage:y,verified:!1,socialLinks:C};console.log("All Data: selectedAddress ",t);try{const s=await $.put(`/user/update_user/${n}`,t);f.success("تم حفظ التعديلات بنجاح"),console.log(s.data)}catch(s){console.error("خطأ في تحديث البيانات:",s),f.error("فشل في تحديث البيانات")}},h=({selectedArea:a,selectedGovernments:t})=>{N(s=>s.area===a&&JSON.stringify(s.govern)===JSON.stringify(t)?s:{area:a,govern:t})},U=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){f.error("يرجى رفع ملف صورة فقط.");return}if(t.size>2*1024*1024){f.error("حجم الصورة كبير جدًا. الحد الأقصى هو 2 ميغابايت.");return}k(0);const s=u.email||"noUser",r=E(G,`${s}/profile/${t.name}`),x=M(r,t);x.on("state_changed",o=>{const B=o.bytesTransferred/o.totalBytes*100;k(B)},o=>{f.error("خطأ أثناء رفع الصورة."),console.error("خطأ أثناء رفع الصورة:",o)},async()=>{try{const o=await O(x.snapshot.ref);v(o),k(0),f.success("تم رفع الصورة بنجاح.")}catch(o){console.error("خطأ في الحصول على رابط التنزيل:",o)}})};return e.jsxs(J,{children:[e.jsx(W,{children:e.jsx(H,{className:"text-3xl font-bold text-indigo-900 mt-10",children:"إعدادات الحساب"})}),e.jsxs(V,{children:[e.jsx("p",{className:"mb-6 text-gray-600",children:"يمكنك هنا تحديث بيانات حسابك بما في ذلك التفاصيل الشخصية وصورتك الشخصية."}),e.jsxs("form",{onSubmit:w(_),className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx(I,{name:"profilePicture",control:m,render:({field:a})=>e.jsx("img",{className:"object-cover w-32 h-32 rounded-full ring-4 ring-indigo-300 mb-4",src:y||u.profileImage||"https://via.placeholder.com/150",alt:"Profile"})}),e.jsxs(D,{htmlFor:"profilePicture",className:"cursor-pointer",children:[e.jsx("span",{className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300",children:"تغيير الصورة الشخصية"}),e.jsx(F,{id:"profilePicture",type:"file",accept:"image/*",onChange:U,className:"hidden"}),S!==0&&e.jsx("div",{className:"relative w-full mt-4 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${S}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"name",children:"اسم الشهرة او الحساب*"}),e.jsx(I,{name:"name",control:m,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"email",children:"البريد الإلكتروني* "}),e.jsx(I,{name:"email",control:m,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"phone",children:"رقم الهاتف*"}),e.jsx(I,{name:"phone",control:m,rules:{required:"رقم الهاتف مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(F,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("label",{htmlFor:"",children:"التواصل الاجتماعي"}),C.map((a,t)=>(a.link||a.label)&&e.jsx("div",{className:"space-y- col-span-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 text-gray-800 flex items-center justify-between",children:e.jsx("input",{type:"url",value:a.link||"",onChange:s=>P(t,s.target.value),className:"w-full bg-gray-100 border-none focus:ring-0",placeholder:`أدخل الرابط لـ ${a.label||"التواصل الاجتماعي"}`})})},t))]}),e.jsx(X,{initialData:L,onSelectionChange:h})]}),e.jsx(K,{type:"submit",className:"w-full text-white",children:"حفظ التغييرات"})]})]}),e.jsx(Q,{position:"top-center",reverseOrder:!1})]})},ee=({type:n="null",size:c=18})=>{const j={null:"transparent",none:"white",silver:"#C0C0C0",bronze:"#CD7F32",gold:"#FFD700"},u=n==="none"?"black":j[n];return e.jsx("svg",{width:c,height:c,viewBox:"0 0 24 24",fill:j[n],stroke:u,strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"star",children:e.jsx("polygon",{points:"12 2 15 9 22 9 16 14 18 21 12 17 6 21 8 14 2 9 9 9"})})},fe=()=>{var t;const[n,c]=l.useState([]),{allUsers:j,updateUser:u}=T(),[d,L]=l.useState("all"),[b,y]=l.useState("all"),{user:v}=R();console.log("User:",v.role);const{id:m}=q();l.useEffect(()=>{if(m&&n.length>0){const s=n.find(r=>r._id===m);s&&U(s._id)}},[m,n]);const w=n.filter(s=>{var o;const r=d==="all"||s.address.area===d,x=b==="all"||((o=s.address.govern)==null?void 0:o.includes(b));return r&&x}),[i,g]=l.useState(1),N=20,S=i*N,k=S-N,C=w.slice(k,S),p=Math.ceil(w.length/N),[P,_]=l.useState("");l.useEffect(()=>{(async()=>{try{const r=await $.get("/user/all_users");c(r.data.data)}catch(r){console.log(r)}})()},[j]);const[h,U]=l.useState(null),a=s=>{c(r=>r.map(x=>x._id===s._id?s:x)),u(s)};return e.jsxs("div",{className:"grow md:p-8 p-2  dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"النجوم"}),e.jsxs("div",{className:"my-6  bg-white  dark:bg-gray-800 rounded-lg shadow-md p-4 w-fit md:w-full max-w-screen overflow-x-auto",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex gap-4 mb-4 flex-col md:flex-row",children:[e.jsxs("select",{value:d,onChange:s=>{L(s.target.value),g(1),y("all")},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"كل المناطق"}),A.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:b,onChange:s=>{y(s.target.value),g(1)},className:"border rounded px-2 py-1",disabled:d==="all",children:[e.jsx("option",{value:"all",children:"كل المحافظات"}),d!=="all"&&((t=A.find(s=>s.name===d))==null?void 0:t.subGovernments.map(s=>e.jsx("option",{value:s,children:s},s)))]})]})}),e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات النجوم"}),e.jsxs("table",{className:"table-auto w-fit  md:w-full  text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-1 text-right min-w-36 ",children:"الاسم"}),e.jsx("th",{className:"py-2 px-1 text-right",children:"فئة النجم"})]})}),e.jsx("tbody",{children:C.map((s,r)=>s.role==="star"&&e.jsxs("tr",{onClick:()=>U(s._id),className:`border-b hover:bg-gray-100 dark:hover:bg-gray-700 ${s._id===h?"bg-gray-200 dark:bg-gray-600":""}`,children:[e.jsx("td",{className:"py-2 px-1",children:s.name}),e.jsx("td",{className:"py2 px4 flex items-center gap-2 ",children:s.verified&&e.jsx(ee,{type:s.accountType,size:32})})]},r))})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>g(s=>Math.max(s-1,1)),disabled:i===1,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"السابق"}),Array.from({length:p},(s,r)=>e.jsx("button",{onClick:()=>g(r+1),className:`px-4 py-2 mx-1 rounded-lg ${i===r+1?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:r+1},r)),e.jsx("button",{onClick:()=>g(s=>Math.min(s+1,p)),disabled:i===p,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"التالي"})]})]}),h&&e.jsx(Z,{selectedUserUid:h,usersData:n,onSave:a}),h&&v.role==="admin"&&e.jsx(Y,{selectedUserUid:h,usersData:n,onSave:a})]})};export{fe as default};
