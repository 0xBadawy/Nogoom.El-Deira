import{b as G,r as l,j as e,f as $,s as B,g as E,h as O,c as R,e as T,k as z}from"./index-DA4Gzd_l.js";import{u as q,C as I}from"./index.esm-Dwi1UnKn.js";import{C as J,a as H,b as V,c as W}from"./card-aN9eNxXE.js";import{L,I as P}from"./textarea-C7xSP03A.js";import{B as K}from"./button-CQhZKckC.js";import{D as Q,k as p}from"./index-DWwPS4Yg.js";import{A as X}from"./AreaGovernmentSelector-BMo8pKPf.js";import{G as A}from"./data-Csv9xAeZ.js";import{U as Y}from"./UserDetailsBalance-BR0L-zdH.js";import{G as Z}from"./iconBase-jCZv8vzb.js";import"./index-JbbjrJmS.js";import"./index-BygZvNhR.js";import"./data-CyOksF0G.js";import"./index-BqENzE_7.js";import"./index-D4Rbr5yG.js";import"./index-C-kFAFhx.js";import"./index-CMYCgMp9.js";const ee=({selectedUserUid:n,usersData:f})=>{const{updateUser:D}=G(),[N,i]=l.useState({}),[F,b]=l.useState({}),[j,m]=l.useState(""),{control:g,handleSubmit:x,setValue:o}=q(),[y,S]=l.useState({}),[k,v]=l.useState(0),[d,w]=l.useState([]);l.useEffect(()=>{var t,s;const a=f.find(r=>r._id===n);console.log(a),a&&(i(a),b({area:((t=a.address)==null?void 0:t.area)||"",governments:((s=a.address)==null?void 0:s.govern)||[]}),w(a.social||[]),o("name",a.name),o("phone",a.phone),o("bio",a.bio),o("email",a.email),m(a.profileImage||""),console.log(a.profileImage||""))},[n,f,o]);const _=(a,t)=>{const s=[...d];s[a].link=t,w(s)},h=async a=>{const t={...a,selectedAddress:y,profileImage:j,verified:!1,socialLinks:d};try{const s=await R.put(`/user/update_user/${n}`,t);await D(s.data.data),p.success("تم حفظ التعديلات بنجاح"),console.log(s.data)}catch(s){console.error("خطأ في تحديث البيانات:",s),p.error("فشل في تحديث البيانات")}},C=({selectedArea:a,selectedGovernments:t})=>{S(s=>s.area===a&&JSON.stringify(s.govern)===JSON.stringify(t)?s:{area:a,govern:t})},U=a=>{const t=a.target.files[0];if(!t)return;if(!t.type.startsWith("image/")){p.error("يرجى رفع ملف صورة فقط.");return}if(t.size>2*1024*1024){p.error("حجم الصورة كبير جدًا. الحد الأقصى هو 2 ميغابايت.");return}v(0);const s=N.email||"noUser",r=$(B,`${s}/profile/${t.name}`),u=E(r,t);u.on("state_changed",c=>{const M=c.bytesTransferred/c.totalBytes*100;v(M)},c=>{p.error("خطأ أثناء رفع الصورة."),console.error("خطأ أثناء رفع الصورة:",c)},async()=>{try{const c=await O(u.snapshot.ref);m(c),v(0),p.success("تم رفع الصورة بنجاح.")}catch(c){console.error("خطأ في الحصول على رابط التنزيل:",c)}})};return e.jsxs(J,{children:[e.jsx(H,{children:e.jsx(V,{className:"text-3xl font-bold text-indigo-900 mt-10",children:"إعدادات الحساب"})}),e.jsxs(W,{children:[e.jsx("p",{className:"mb-6 text-gray-600",children:"يمكنك هنا تحديث بيانات حسابك بما في ذلك التفاصيل الشخصية وصورتك الشخصية."}),e.jsxs("form",{onSubmit:x(h),className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsx(I,{name:"profilePicture",control:g,render:({field:a})=>e.jsx("img",{className:"object-cover w-32 h-32 rounded-full ring-4 ring-indigo-300 mb-4",src:j||N.profileImage||"https://via.placeholder.com/150",alt:"Profile"})}),e.jsxs(L,{htmlFor:"profilePicture",className:"cursor-pointer",children:[e.jsx("span",{className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-300",children:"تغيير الصورة الشخصية"}),e.jsx(P,{id:"profilePicture",type:"file",accept:"image/*",onChange:U,className:"hidden"}),k!==0&&e.jsx("div",{className:"relative w-full mt-4 h-2 bg-gray-200 rounded-lg dark:bg-gray-700",children:e.jsx("div",{className:"absolute top-0 left-0 h-2 rounded-lg bg-blue-500",style:{width:`${k}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"name",children:"اسم الشهرة او الحساب*"}),e.jsx(I,{name:"name",control:g,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"البريد الإلكتروني* "}),e.jsx(I,{name:"email",control:g,rules:{required:"الاسم الكامل مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"phone",children:"رقم الهاتف*"}),e.jsx(I,{name:"phone",control:g,rules:{required:"رقم الهاتف مطلوب"},render:({field:a,fieldState:{error:t}})=>e.jsxs(e.Fragment,{children:[e.jsx(P,{...a}),t&&e.jsx("span",{className:"text-red-500 text-sm",children:t.message})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsx("label",{htmlFor:"",children:"التواصل الاجتماعي"}),d.map((a,t)=>(a.link||a.label)&&e.jsx("div",{className:"space-y- col-span-3",children:e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 text-gray-800 flex items-center justify-between",children:e.jsx("input",{type:"url",value:a.link||"",onChange:s=>_(t,s.target.value),className:"w-full bg-gray-100 border-none focus:ring-0",placeholder:`أدخل الرابط لـ ${a.label||"التواصل الاجتماعي"}`})})},t)),e.jsx("button",{type:"button",onClick:()=>w([...d,{label:"",link:" "}]),className:"col-span-3 mt-4 max-h-10 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700",children:"إضافة رابط جديد"})]}),e.jsx(X,{initialData:F,onSelectionChange:C})]}),e.jsx(K,{type:"submit",className:"w-full text-white",children:"حفظ التغييرات"})]})]}),e.jsx(Q,{position:"top-center",reverseOrder:!1})]})};function se(n){return Z({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 0 0 .6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0 0 46.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3z"},child:[]}]})(n)}const je=()=>{var t;const[n,f]=l.useState([]),{allUsers:D,updateUser:N}=T(),[i,F]=l.useState("all"),[b,j]=l.useState("all"),{id:m}=z();console.log("useParams output:",m),l.useEffect(()=>{if(m&&n.length>0){const s=n.find(r=>r._id===m);s&&C(s._id)}},[m,n]);const g=n.filter(s=>{var c;const r=i==="all"||s.address.area===i,u=b==="all"||((c=s.address.govern)==null?void 0:c.includes(b));return console.log("regionMatch:",s.address.govern),console.log("governMatch:",s.address.area),r&&u}),[x,o]=l.useState(1),y=20,S=x*y,k=S-y,v=g.slice(k,S),d=Math.ceil(g.length/y),[w,_]=l.useState("");l.useEffect(()=>{(async()=>{try{const r=await R.get("/user/all_users");console.log(r.data.data),f(r.data.data)}catch(r){console.log(r)}})()},[D]);const[h,C]=l.useState(null),U=s=>{f(r=>r.map(u=>u._id===s._id?s:u)),N(s)},a=s=>{switch(s){case"none":return"transparent";case"silver":return"text-white";case"gold":return"text-yellow-500";case"bronze":return"text-yellow-200";default:return""}};return e.jsxs("div",{className:"grow md:p-8 p-2  dark:bg-gray-800 h-full",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"النجوم"}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 w-full max-w-screen overflow-x-auto",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("select",{value:i,onChange:s=>{F(s.target.value),o(1),j("all")},className:"border rounded px-2 py-1",children:[e.jsx("option",{value:"all",children:"كل المناطق"}),A.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:b,onChange:s=>{j(s.target.value),o(1)},className:"border rounded px-2 py-1",disabled:i==="all",children:[e.jsx("option",{value:"all",children:"كل المحافظات"}),i!=="all"&&((t=A.find(s=>s.name===i))==null?void 0:t.subGovernments.map(s=>e.jsx("option",{value:s,children:s},s)))]})]})}),e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"بيانات النجوم"}),e.jsxs("table",{className:"table-auto w-fit  text-sm md:text-base",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-2 px-1 text-right min-w-36 ",children:"الاسم"}),e.jsx("th",{className:"py-2 px-1 text-right",children:"فئة النجم"})]})}),e.jsx("tbody",{children:v.map((s,r)=>s.role==="star"&&e.jsxs("tr",{onClick:()=>C(s._id),className:`border-b hover:bg-gray-100 dark:hover:bg-gray-700 ${s._id===h?"bg-gray-200 dark:bg-gray-600":""}`,children:[e.jsx("td",{className:"py-2 px-1",children:s.name}),e.jsx("td",{className:"py2 px4 flex items-center gap-2 ",children:s.accountType!=="none"&&e.jsx(se,{className:a(s.accountType),size:24})})]},r))})]}),e.jsxs("div",{className:"flex justify-center mt-4",children:[e.jsx("button",{onClick:()=>o(s=>Math.max(s-1,1)),disabled:x===1,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"السابق"}),Array.from({length:d},(s,r)=>e.jsx("button",{onClick:()=>o(r+1),className:`px-4 py-2 mx-1 rounded-lg ${x===r+1?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:r+1},r)),e.jsx("button",{onClick:()=>o(s=>Math.min(s+1,d)),disabled:x===d,className:"px-4 py-2 mx-1 bg-gray-200 rounded-lg dark:bg-gray-700 disabled:opacity-50",children:"التالي"})]})]}),h&&e.jsx(ee,{selectedUserUid:h,usersData:n,onSave:U}),h&&e.jsx(Y,{selectedUserUid:h,usersData:n,onSave:U})]})};export{je as default};
