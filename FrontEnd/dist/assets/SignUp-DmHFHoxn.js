import{j as e,b as C,u as T,e as R,r as c,L as v,f as B,s as E,g as G,h as M,c as A}from"./index-DdLreGOM.js";import{u as _}from"./index.esm-B8FwMarM.js";import{L as z}from"./Deira-logo2-q4QQy5sZ.js";import{T as n}from"./data-Csv9xAeZ.js";import{D as J,k as t}from"./index-JBFvlLZ8.js";import{A as O}from"./AreaGovernmentSelector-2YGPETkW.js";import"./data-CyOksF0G.js";const u=({id:d,label:g,type:l="text",register:x})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:d,className:"block text-gray-700 text-sm font-bold mb-2",children:g}),e.jsx("input",{id:d,type:l,className:"w-full px-3 py-2 border rounded-lg focus:outline-none",...x(d)})]}),ee=()=>{const{signup:d}=C(),g=T(),{register:l,handleSubmit:x}=_(),{SendSignupNotification:Z}=R(),[h,w]=c.useState(0),[p,k]=c.useState(""),[b,S]=c.useState({area:"",govern:[]}),[i,j]=c.useState([{type:"general",link:""}]),[y,f]=c.useState(null),[q,m]=c.useState(!1),P=(s,a)=>{const r=[...i];r[s].link=a,j(r)},U=s=>{if(s.preventDefault(),i.length>=6){t.error("لا يمكنك إضافة أكثر من 6 روابط.");return}j([...i,{type:"general",link:""}])},I=({selectedArea:s,selectedGovernments:a})=>{S(r=>r.area!==s||r.govern.join(",")!==a.join(",")?{area:s,govern:a}:r)},L=async s=>{if(!s.privacyPolicy){t.error("يجب الموافقة على سياسة الخصوصية");return}if(s.password.length<6||s.password.length>11||!/[a-zA-Z]/.test(s.password)){t.error("يجب أن تحتوي كلمة المرور على 6-11 حرفًا وتتضمن حرفًا واحدًا على الأقل");return}if(s.confirmPassword!==s.password){t.error("كلمة المرور غير متطابقة");return}if(b.area===""||b.govern.length===0){t.error("يجب اختيار المنطقة والمحافظة");return}if(i.length===0){t.error("يجب إضافة رابط واحد على الأقل");return}if(!p){t.error("يجب اختيار صورة شخصية");return}const a={...s,address:b,social:i,profileImage:p};try{m(!0),f(null);const r=await A.post("/auth/signup",a);localStorage.setItem("token",r.data.token),d(r.data.user),t.success(" تم انشاء الحساب بنجاح"),g("/Status")}catch(r){r.response?f(r.response.data.message==="UserExists"?"البريد الإلكتروني مستخدم بالفعل":r.response.data.message==="PasswordNotMatch"?"كلمة المرور غير متطابقة":"حدث خطأ أثناء معالجة الطلب، يرجى المحاولة مرة أخرى"):f("خطأ غير متوقع")}finally{m(!1)}},D=async s=>{if(!s)return;if(!["image/jpeg","image/png","image/gif","image/webp"].includes(s.type)){t.error(`نوع الملف غير مدعوم: ${s.name}`);return}m(!0);const F=B(E,`noUser/images/${s.name}`),N=G(F,s);N.on("state_changed",o=>{const $=o.bytesTransferred/o.totalBytes*100;w($)},o=>{t.error(`خطأ في رفع الملف: ${o.message}`),m(!1)},async()=>{try{const o=await M(N.snapshot.ref);k(o),console.log("Media URL:",o)}catch(o){t.error(`خطأ في الحصول على رابط الصورة: ${o.message}`)}finally{m(!1)}})};return e.jsxs("div",{className:"PatternBG py-10 flex items-center justify-center min-h-screen",children:[e.jsxs("div",{className:"w-full max-w-7xl bg-white p-6 rounded-lg shadow-md",children:[e.jsx("img",{src:z,alt:"logo",className:"w-10 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:n.title}),y&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("strong",{className:"font-bold",children:"خطأ!"})," ",y]}),e.jsxs("form",{onSubmit:x(L),children:[e.jsxs("div",{className:"mb-4",children:[p?e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("img",{src:p,alt:"Preview",className:"w-48 h-48 object-cover rounded-full "})}):e.jsx("div",{className:"mt-1 flex  justify-center px- pt-5 pb-6 border-2 border-gray-300 border-dashed mx-auto w-48 h-48 object-cover rounded-full",children:e.jsxs("div",{className:"space-y-1 text-center mt-12 ",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>D(s.target.files[0]),className:"hidden",id:"image-upload"}),e.jsx("label",{htmlFor:"image-upload",className:"cursor-pointer text-xs bg-white py-2 px -4  border border-gray-300 rounded-md shadow-sm   font-medium text-gray-700 hover:bg-gray-50",children:"اختر صورة شخصية او صورة حسابك"}),e.jsx("p",{className:"text-xs text-gray-500 pt-4",children:"PNG, JPG, GIF حتى 10MB"})]})}),h>0&&h<100&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${h}%`}})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{id:"name",label:"أسم الشهرة او الحساب*",register:l}),e.jsx(u,{id:"email",label:n.email,type:"email",register:l}),e.jsx(u,{id:"phone",label:n.phone,register:l}),e.jsx(u,{id:"password",label:n.password,type:"password",register:l}),e.jsx(u,{id:"confirmPassword",label:"تأكيد كلمة المرور",type:"password",register:l})]}),e.jsx(O,{onSelectionChange:I}),e.jsxs("div",{className:"w-full mx-auto",children:[e.jsx("label",{className:"block text-gray-700",children:"روابط التواصل الاجتماعي"}),i.map((s,a)=>e.jsx("input",{type:"url",value:s.link,onChange:r=>P(a,r.target.value),className:"block w-full p-2 mb-2 border border-gray-300 rounded-md focus:outline-none",placeholder:`الرابط رقم ${a+1}`},a)),e.jsx("button",{className:"mt-2 bg-blue-500 text-white p-2 rounded-md",onClick:U,children:"اضف رابط اخر +"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"block text-gray-700",children:[e.jsx("input",{type:"checkbox",className:"mr-2",...l("privacyPolicy")}),n.privacyPolicy,e.jsx("a",{href:"/privacy-policy",target:"_blank",rel:"noopener noreferrer",className:"text-blue-700 font-bold",children:n.privacyPolicyLink})]})}),e.jsx("button",{type:"submit",className:"w-fit px-20 mx-auto bg-indigo-600 text-white py-2 mt-6 rounded-lg",children:n.signUp}),e.jsxs("div",{className:"flex justify-center gap-20 p-4",children:[e.jsx(v,{to:"/login",className:"text-blue-500 font-semibold hover:underline",children:"تسجيل الدخول"}),e.jsx(v,{to:"/",className:"text-blue-500 font-semibold hover:underline",children:"الصفحة الرئيسية"})]})]})]}),e.jsx(J,{position:"top-center",reverseOrder:!1})]})};export{ee as default};
